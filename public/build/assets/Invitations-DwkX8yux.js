import{d as f,y as M,q as A,e as c,o as l,f as y,a as e,t as d,F as j,h as N,g as I,i as L,c as B,w as D,u as T,Q as C,b as U}from"./app-CkYNA2PG.js";import{_ as R}from"./InvitationLayout-Cjh4hh6M.js";import"./WorkspaceSidebar-DE7nfgqH.js";import"./ChannelListSidebar-CW67Kks2.js";import"./Modal-y7r60rUr.js";import"./PrimaryButton-CYuMPLdJ.js";import"./SecondaryButton-WQ_DH_YH.js";const O={key:0,class:"max-w-md mx-auto mb-4"},V={class:"bg-red-50 border border-red-200 rounded-lg p-4"},E={class:"flex"},z={class:"ml-3"},q={class:"text-sm text-red-800"},F={key:1,class:"space-y-6 max-w-md mx-auto"},P=["data-invitation-id"],J={class:"flex items-center gap-4 flex-1 min-w-0"},Q={class:"h-12 w-12 rounded-full bg-indigo-100 flex items-center justify-center text-xl font-bold text-indigo-600"},H={class:"min-w-0"},K={class:"font-semibold text-lg text-gray-900 truncate"},X={class:"text-sm text-gray-500 truncate"},G={class:"font-medium text-indigo-700"},W={key:0,class:"text-sm text-gray-500 truncate"},Y={class:"font-medium text-indigo-700"},Z={class:"flex flex-col gap-0.5 mt-1"},ee={class:"text-xs text-gray-400"},te={class:"text-xs text-orange-600"},se={class:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-2 min-w-fit"},ne=["onClick","disabled"],oe=["onClick","disabled"],ie={key:2,class:"bg-white shadow rounded-lg max-w-lg mx-auto mt-8"},ae={__name:"InvitationNotification",props:{invitations:{type:Array,default:()=>[]}},emits:["invitation-responded"],setup(m,{emit:b}){const g=m,v=b,h=f([]),r=f(!1),u=f(""),a=f(null),w=M(()=>g.invitations.length>0?g.invitations:h.value),$=async()=>{if(!(g.invitations.length>0)){r.value=!0,u.value="";try{const i=await fetch("/my-invitations"),o=await i.json();i.ok?h.value=o:u.value=o.message||"招待の取得に失敗しました"}catch{u.value="招待の取得に失敗しました"}finally{r.value=!1}}},p=async(i,o)=>{var n,x;if(a.value!==i){a.value=i;try{const s=((n=document.querySelector('meta[name="csrf-token"]'))==null?void 0:n.getAttribute("content"))||((x=document.querySelector('input[name="_token"]'))==null?void 0:x.value),t=await fetch(`/invitations/${i}/respond`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":s},body:JSON.stringify({action:o})}),_=await t.json();t.ok?(g.invitations.length>0?v("invitation-responded",{invitationId:i,action:o,data:_}):h.value=h.value.filter(S=>S.id!==i),window.dispatchEvent(new CustomEvent("invitation-count-updated"))):(console.error("Invitation response error:",_),u.value=_.message||_.error||"招待の応答に失敗しました")}catch(s){console.error("Invitation response exception:",s),u.value="招待の応答に失敗しました"}finally{a.value=null}}},k=i=>new Date(i).toLocaleString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return A(()=>{$()}),(i,o)=>(l(),c(j,null,[u.value?(l(),c("div",O,[e("div",V,[e("div",E,[o[0]||(o[0]=e("div",{class:"flex-shrink-0"},[e("svg",{class:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),e("div",z,[e("p",q,d(u.value),1)])])])])):y("",!0),w.value.length>0?(l(),c("div",F,[(l(!0),c(j,null,N(w.value,n=>(l(),c("div",{key:n.id,"data-invitation-id":n.id,class:"bg-white shadow rounded-xl p-5 flex flex-row items-center justify-between gap-4 border border-gray-100 transition-all duration-300"},[e("div",J,[e("div",Q,d(n.inviter.name.charAt(0).toUpperCase()),1),e("div",H,[e("div",K,d(n.channel.name),1),e("div",X,[o[1]||(o[1]=I("招待者: ")),e("span",G,d(n.inviter.name),1)]),n.invitee?(l(),c("div",W,[o[2]||(o[2]=I(" 招待先: ")),e("span",Y,d(n.invitee.name||n.invitee.email),1)])):y("",!0),e("div",Z,[e("span",ee,"招待日時: "+d(k(n.created_at)),1),e("span",te,"有効期限: "+d(k(n.expires_at)),1)])])]),e("div",se,[e("button",{onClick:x=>p(n.id,"accept"),class:"px-4 py-2 rounded font-semibold text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-400 focus:ring-offset-2 transition disabled:opacity-60",disabled:a.value===n.id},d(a.value===n.id?"処理中...":"承認"),9,ne),e("button",{onClick:x=>p(n.id,"decline"),class:"px-4 py-2 rounded font-semibold text-gray-700 bg-gray-100 hover:bg-gray-200 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2 transition disabled:opacity-60",disabled:a.value===n.id},d(a.value===n.id?"処理中...":"拒否"),9,oe)])],8,P))),128))])):(l(),c("div",ie,o[3]||(o[3]=[L('<div class="px-4 py-5 sm:p-6 text-center"><div class="text-gray-400 mb-4"><svg class="mx-auto h-12 w-12" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 002 2z"></path></svg></div><h3 class="text-lg font-medium text-gray-900 mb-2">招待通知はありません</h3><p class="text-gray-500">現在、あなたへの招待通知はありません。</p></div>',1)])))],64))}},le={class:"w-full max-w-lg mx-auto pt-8"},re={key:0,class:"mt-6 p-4 bg-purple-50 border border-purple-200 rounded-lg flex items-center justify-between"},de={class:"flex items-center"},ce={class:"text-purple-800 font-semibold"},ue={key:1,class:"mt-2 text-sm text-red-500"},me={key:2,class:"mt-6 p-4 bg-green-50 border border-green-200 rounded-lg"},fe={key:3,class:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg"},ge={class:"flex items-center"},ve={class:"ml-3"},pe={class:"mt-3"},he=["href"],xe=["href"],ye={class:"mt-4"},je={__name:"Invitations",props:{channels:{type:Array,default:()=>[]},"direct-messages":{type:Array,default:()=>[]},invitations:{type:Array,default:()=>[]},messages:{type:Array,default:()=>[]},manualOffline:{type:Boolean,default:!1},isAuthenticated:{type:Boolean,default:!1}},setup(m){const b=f(0),g=f(!1),v=f(""),h=async()=>{g.value=!0,v.value="";try{const s=await fetch("/api/direct-messages/unread-count",{headers:{Accept:"application/json"}}),t=await s.json();s.ok&&typeof t.count=="number"?b.value=t.count:v.value=t.error||"未読DM件数の取得に失敗しました"}catch{v.value="未読DM件数の取得に失敗しました"}finally{g.value=!1}},r=m,u=new URLSearchParams(window.location.search),a=u.get("invitation"),w=u.get("registered"),$=M(()=>!r["direct-messages"]||!Array.isArray(r["direct-messages"])?[]:r["direct-messages"]),p=M(()=>r.invitations.filter(s=>!s.invitee_id)),k=f(w==="true"),i=s=>{s.action==="accept"?(alert("チャンネルに参加しました！"),window.location.reload()):s.action==="decline"&&(alert("招待を拒否しました。"),window.location.reload())},o=s=>{C.visit(`/dashboard?channel=${s}`)},n=s=>{C.put("/api/user/online-status",{manual_offline:s})},x=s=>{console.log("New channel added:",s)};return A(()=>{if(console.log("Invitations page props:",r),console.log("Invitations count:",r.invitations.length),console.log("Invitations data:",r.invitations),console.log("Invitation ID from URL:",a),a){const s=r.invitations.find(t=>t.id==a);s&&(console.log("Found target invitation:",s),setTimeout(()=>{const t=document.querySelector(`[data-invitation-id="${a}"]`);t&&(t.scrollIntoView({behavior:"smooth",block:"center"}),t.classList.add("ring-2","ring-indigo-500","ring-opacity-50"))},500))}h()}),(s,t)=>(l(),B(R,{title:"招待通知",channels:m.channels,"direct-messages":$.value,messages:m.messages,"manual-offline":m.manualOffline,onSelectChannel:o,onToggleManualOffline:n,onNewChannelAdded:x},{default:D(()=>[e("div",le,[t[6]||(t[6]=e("h1",{class:"text-2xl font-bold text-gray-900 text-center"},"招待通知",-1)),t[7]||(t[7]=e("p",{class:"text-gray-600 mt-2 text-center"},"あなたが招待されたチャンネルの通知がここに表示されます。",-1)),b.value>0?(l(),c("div",re,[e("div",de,[t[1]||(t[1]=e("span",{class:"inline-flex items-center justify-center h-8 w-8 rounded-full bg-purple-100 text-purple-600 mr-3"},[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 8h10M7 12h4m1 8a9 9 0 100-18 9 9 0 000 18z"})])],-1)),e("span",ce,"新着ダイレクトメッセージが"+d(b.value)+"件あります",1)]),e("button",{onClick:t[0]||(t[0]=_=>T(C).visit("/direct-messages")),class:"ml-4 px-3 py-1 bg-purple-600 text-white text-sm rounded hover:bg-purple-700 transition-colors"},"DM画面へ")])):y("",!0),v.value?(l(),c("div",ue,d(v.value),1)):y("",!0),k.value?(l(),c("div",me,t[2]||(t[2]=[e("div",{class:"flex items-center"},[e("div",{class:"flex-shrink-0"},[e("div",{class:"h-8 w-8 rounded-full bg-green-100 flex items-center justify-center"},[e("span",{class:"text-green-600 text-sm font-medium"},"✅")])]),e("div",{class:"ml-3"},[e("h3",{class:"text-sm font-medium text-green-800"}," アカウント作成完了！ "),e("p",{class:"text-sm text-green-600 mt-1"}," アカウントが正常に作成され、チャンネルに自動参加しました。 ")])],-1)]))):y("",!0),!m.isAuthenticated&&p.value.length>0?(l(),c("div",fe,[e("div",ge,[t[5]||(t[5]=e("div",{class:"flex-shrink-0"},[e("div",{class:"h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center"},[e("span",{class:"text-blue-600 text-sm font-medium"},"📝")])],-1)),e("div",ve,[t[3]||(t[3]=e("h3",{class:"text-sm font-medium text-blue-800"}," アカウントを作成してチャンネルに参加 ",-1)),t[4]||(t[4]=e("p",{class:"text-sm text-blue-600 mt-1"}," 招待を受けるには、まずSlack Cloneのアカウントを作成してください。 ",-1)),e("div",pe,[e("a",{href:`/register?invitation=${p.value[0].id}&email=${encodeURIComponent(p.value[0].invitee_email)}`,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," アカウントを作成 ",8,he),e("a",{href:`/login?email=${encodeURIComponent(p.value[0].invitee_email)}`,class:"ml-3 inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"}," 既存アカウントでログイン ",8,xe)])])])])):y("",!0),e("div",ye,[U(ae,{invitations:m.invitations,onInvitationResponded:i},null,8,["invitations"])])])]),_:1},8,["channels","direct-messages","messages","manual-offline"]))}};export{je as default};
