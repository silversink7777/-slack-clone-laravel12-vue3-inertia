import{e as l,o as n,a as e,d as f,B as H,q as F,z as L,A as Y,f as $,c as E,b as v,u as d,t as b,n as Z,C as ee,k as I,v as K,g as R,F as N,h as Q,Q as q,j as G,p as se,r as J}from"./app-KnxPcEFb.js";import{r as z,a as ae,_ as re,b as oe}from"./ChannelListSidebar-T2mu11WA.js";function ne(o,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 12a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm0 0c0 1.657 1.007 3 2.25 3S21 13.657 21 12a9 9 0 1 0-2.636 6.364M16.5 12V8.25"})])}function T(o,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}function le(o,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function de(o,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 17.25v1.007a3 3 0 0 1-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0 1 15 18.257V17.25m6-12V15a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 15V5.25m18 0A2.25 2.25 0 0 0 18.75 3H5.25A2.25 2.25 0 0 0 3 5.25m18 0V12a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 12V5.25"})])}function ie(o,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.182 15.182a4.5 4.5 0 0 1-6.364 0M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Z"})])}function ce(o,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}function ue(o,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z"})])}function W(o,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"})])}function ge(o,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})])}function he(o,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"})])}function ve(o,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})])}function X(o,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"})])}function me(o,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})])}function xe(o,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"})])}function te(o,i){return n(),l("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})])}function ye(){const o=f("system"),i=f(!1),h=f(!1),y=()=>window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",t=r=>{(r==="system"?y():r)==="dark"?(document.documentElement.classList.add("dark"),i.value=!0):(document.documentElement.classList.remove("dark"),i.value=!1)},s=async()=>{try{const r=await L.get("/api/auth/check");return console.log("Auth status:",r.data),r.data.authenticated}catch(r){return console.error("Failed to check auth status:",r),!1}},c=async()=>{var r,a;try{h.value=!0,console.log("Loading theme...");const m=await s();console.log("Is authenticated:",m);const u=await L.get("/theme");console.log("Theme loaded successfully:",u.data),o.value=u.data.theme,t(o.value)}catch(m){console.error("Failed to load theme:",m),console.error("Error response:",(r=m.response)==null?void 0:r.data),console.error("Error status:",(a=m.response)==null?void 0:a.status),o.value="system",t("system")}finally{h.value=!1}},k=async r=>{var a,m;try{h.value=!0,console.log("Updating theme to:",r);const u=await s();console.log("Is authenticated:",u),await L.post("/theme",{theme:r}),console.log("Theme updated successfully"),o.value=r,t(r)}catch(u){throw console.error("Failed to update theme:",u),console.error("Error response:",(a=u.response)==null?void 0:a.data),console.error("Error status:",(m=u.response)==null?void 0:m.status),u}finally{h.value=!1}},p=()=>{window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{o.value==="system"&&t("system")})};return H(o,r=>{t(r)}),F(()=>{c(),p()}),{theme:o,isDark:i,isLoading:h,updateTheme:k,loadTheme:c}}const pe={class:"relative"},fe=["disabled"],ke={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},we={key:0,class:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50"},be={class:"py-1"},_e={__name:"ThemeToggle",setup(o){const{theme:i,isDark:h,isLoading:y,updateTheme:t}=ye(),s=f(!1),c=r=>{switch(r){case"light":return"ライト";case"dark":return"ダーク";case"system":return"システム";default:return"システム"}},k=async r=>{try{await t(r),s.value=!1}catch(a){console.error("Failed to update theme:",a),alert("テーマの更新に失敗しました")}},p=r=>{r.target.closest(".relative")||(s.value=!1)};return F(()=>{document.addEventListener("click",p)}),Y(()=>{document.removeEventListener("click",p)}),(r,a)=>(n(),l("div",pe,[e("button",{onClick:a[0]||(a[0]=m=>s.value=!s.value),class:"flex items-center space-x-2 px-3 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",disabled:d(y)},[d(h)?(n(),E(d(X),{key:0,class:"h-5 w-5 text-yellow-500"})):(n(),E(d(W),{key:1,class:"h-5 w-5 text-gray-600 dark:text-gray-400"})),e("span",ke,b(c(d(i))),1),v(d(z),{class:"h-4 w-4 text-gray-500 dark:text-gray-400"})],8,fe),s.value?(n(),l("div",we,[e("div",be,[e("button",{onClick:a[1]||(a[1]=m=>k("light")),class:Z(["w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",{"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":d(i)==="light"}])},[v(d(X),{class:"h-4 w-4"}),a[4]||(a[4]=e("span",null,"ライト",-1)),d(i)==="light"?(n(),E(d(T),{key:0,class:"h-4 w-4 ml-auto"})):$("",!0)],2),e("button",{onClick:a[2]||(a[2]=m=>k("dark")),class:Z(["w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",{"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":d(i)==="dark"}])},[v(d(W),{class:"h-4 w-4"}),a[5]||(a[5]=e("span",null,"ダーク",-1)),d(i)==="dark"?(n(),E(d(T),{key:0,class:"h-4 w-4 ml-auto"})):$("",!0)],2),e("button",{onClick:a[3]||(a[3]=m=>k("system")),class:Z(["w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",{"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":d(i)==="system"}])},[v(d(de),{class:"h-4 w-4"}),a[6]||(a[6]=e("span",null,"システム",-1)),d(i)==="system"?(n(),E(d(T),{key:0,class:"h-4 w-4 ml-auto"})):$("",!0)],2)])])):$("",!0)]))}},$e={class:"h-16 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex items-center justify-between px-6"},Ce={class:"flex items-center font-bold text-gray-900 dark:text-gray-100"},Me={class:"flex items-center space-x-4"},je={class:"relative search-container"},Le={key:1,class:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 max-h-96 overflow-y-auto z-50"},Se={key:0,class:"p-4 text-center text-gray-500"},Be={key:1,class:"p-4 text-center text-red-500"},Ee={key:2,class:"py-2"},Ae=["onClick"],De={class:"flex items-start space-x-3"},Ue={class:"flex-shrink-0"},Te={class:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center"},Ve={class:"text-sm font-medium text-gray-600"},Oe={class:"flex-1 min-w-0"},Ze={class:"flex items-center space-x-2"},ze={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},He={class:"text-xs text-gray-500 dark:text-gray-400"},Fe={class:"text-xs text-gray-400 dark:text-gray-500"},Ie={class:"mt-1 text-sm text-gray-700 dark:text-gray-300"},Ke=["innerHTML"],Re={key:3,class:"p-4 text-center text-gray-500"},Ne={class:"text-sm font-medium"},Qe={key:0,class:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-50 border border-gray-200 dark:border-gray-700"},Pe=["href"],qe=["src","alt"],Ge={__name:"MainHeader",props:{activeChannel:Object},setup(o){var w;const h=(w=ee().props.auth)==null?void 0:w.user,y=f(!1),t=f(null),s=f(""),c=f([]),k=f(!1),p=f(!1),r=f("");function a(x,g){let j;return function(...D){const U=()=>{j=null,x.apply(this,D)};clearTimeout(j),j=setTimeout(U,g)}}const m=a(async x=>{if(!x.trim()){c.value=[],p.value=!1;return}k.value=!0,r.value="";try{const g=await L.get("/messages/search",{params:{q:x.trim()}});c.value=g.data.messages,p.value=!0}catch(g){console.error("Search error:",g),r.value="検索中にエラーが発生しました",c.value=[]}finally{k.value=!1}},300),u=()=>{m(s.value)},_=()=>{s.value="",c.value=[],p.value=!1,r.value=""},C=x=>{q.visit(`/dashboard?channel=${x.channel.id}&message=${x.id}`),_()},S=(x,g)=>{if(!g)return x;const j=new RegExp(`(${g})`,"gi");return x.replace(j,'<mark class="bg-yellow-200 text-black px-1 rounded">$1</mark>')},V=()=>{q.post(route("logout"))},O=()=>{y.value=!y.value},A=()=>{y.value=!1},B=x=>{t.value&&!t.value.contains(x.target)&&A();const g=document.querySelector(".search-container");g&&!g.contains(x.target)&&(p.value=!1)};return F(()=>{document.addEventListener("click",B)}),Y(()=>{document.removeEventListener("click",B)}),(x,g)=>{var j,D,U,P;return n(),l("div",$e,[e("div",null,[e("button",Ce,[e("span",null,b((j=o.activeChannel)==null?void 0:j.name),1),v(d(z),{class:"h-5 w-5 ml-1"})])]),e("div",Me,[v(_e),v(d(le),{class:"h-6 w-6 text-gray-500 dark:text-gray-400"}),e("div",je,[v(d(ce),{class:"h-5 w-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),I(e("input",{"onUpdate:modelValue":g[0]||(g[0]=M=>s.value=M),onInput:u,onFocus:g[1]||(g[1]=M=>p.value=!0),type:"text",placeholder:"メッセージを検索する",class:"bg-gray-100 dark:bg-gray-700 rounded-md w-80 pl-10 pr-8 py-1.5 focus:ring-blue-500 focus:border-blue-500 border-transparent text-gray-900 dark:text-gray-100"},null,544),[[K,s.value]]),s.value?(n(),l("button",{key:0,onClick:_,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",title:"検索をクリア"},g[2]||(g[2]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):$("",!0),p.value&&(c.value.length>0||k.value||r.value)?(n(),l("div",Le,[k.value?(n(),l("div",Se,g[3]||(g[3]=[e("div",{class:"flex items-center justify-center"},[e("svg",{class:"animate-spin h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),R(" 検索中... ")],-1)]))):r.value?(n(),l("div",Be,b(r.value),1)):c.value.length>0?(n(),l("div",Ee,[(n(!0),l(N,null,Q(c.value,M=>(n(),l("div",{key:M.id,onClick:Rt=>C(M),class:"px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-100 dark:border-gray-700 last:border-b-0"},[e("div",De,[e("div",Ue,[e("div",Te,[e("span",Ve,b(M.user.name.charAt(0).toUpperCase()),1)])]),e("div",Oe,[e("div",Ze,[e("span",ze,b(M.user.name),1),e("span",He,"#"+b(M.channel.name),1),e("span",Fe,b(M.date)+" "+b(M.time),1)]),e("div",Ie,[e("span",{innerHTML:S(M.content,s.value)},null,8,Ke)])])])],8,Ae))),128))])):(n(),l("div",Re,' "'+b(s.value)+'" に一致するメッセージが見つかりませんでした ',1))])):$("",!0)]),e("div",{ref_key:"userMenuRef",ref:t,class:"relative"},[e("button",{onClick:O,class:"flex items-center space-x-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100 focus:outline-none"},[v(d(ae),{class:"h-8 w-8"}),e("span",Ne,b((D=d(h))==null?void 0:D.name),1),v(d(z),{class:"h-4 w-4"})]),y.value?(n(),l("div",Qe,[e("a",{href:x.route("profile.show"),class:"flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-700"},[e("img",{src:(U=d(h))==null?void 0:U.profile_photo_url,alt:(P=d(h))==null?void 0:P.name,class:"w-8 h-8 rounded-full object-cover mr-2 border border-gray-300 dark:border-gray-600"},null,8,qe),g[4]||(g[4]=e("span",null,"プロフィール",-1))],8,Pe),e("button",{onClick:V,class:"block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}," ログアウト ")])):$("",!0)],512)])])}}},Je={class:"p-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700"},We={class:"border border-gray-200 dark:border-gray-600 rounded-lg p-2 flex flex-col"},Xe={class:"relative"},Ye=["disabled"],et={key:0,class:"emoji-picker-popover absolute left-0 bottom-12 z-50 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded shadow-lg p-2 w-80 max-h-60 overflow-y-auto flex flex-wrap gap-1"},tt=["onClick"],st={class:"flex items-center justify-between mt-2"},at={class:"flex items-center space-x-2"},rt={class:"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},ot={class:"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},nt={class:"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},lt={class:"flex items-center space-x-2"},dt={class:"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},it=["disabled"],ct={__name:"MessageInput",props:{activeChannel:Object},emits:["messageSent"],setup(o,{emit:i}){const h=o,y=i,t=f(""),s=f(!1),c=f(!1),k=["😀","😃","😄","😁","😆","😅","😂","🤣","😊","😇","🙂","🙃","😉","😌","😍","🥰","😘","😗","😙","😚","😋","😜","😝","😛","🤑","🤗","🤩","🤔","🤨","😐","😑","😶","🙄","😏","😣","😥","😮","🤐","😯","😪","😫","🥱","😴","😌","😛","😜","😝","🤤","😒","😓","😔","😕","🙃","🤑","😲","☹️","🙁","😖","😞","😟","😤","😢","😭","😦","😧","😨","😩","🤯","😬","😰","😱","🥵","🥶","😳","🤪","😵","😡","😠","🤬","😷","🤒","🤕","🤢","🤮","🥴","😇","🥳","🥺","🤠","😎","🤓","🧐","😕","🤑","🤡","🤥","🤫","🤭","🫢","🫣","🫡","🤗","🤔","🤭","🤫","🤥","🫠","🫨","🫤","🫦","👍","👎","👏","🙌","🙏","💪","👀","👋","🤙","💯","🔥","✨","🎉","🎊","❤️","🧡","💛","💚","💙","💜","🖤","🤍","🤎","💔","💕","💞","💓","💗","💖","💘"],p=async()=>{if(!(!t.value.trim()||!h.activeChannel)){s.value=!0;try{const u=await L.post("/messages",{content:t.value.trim(),channel_id:h.activeChannel.id});y("messageSent",u.data),t.value=""}catch(u){console.error("Message sending failed:",u)}finally{s.value=!1}}},r=u=>{u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),p())},a=u=>{const _=document.activeElement;if(_&&_.selectionStart!==void 0){const C=_.selectionStart,S=_.selectionEnd;t.value=t.value.substring(0,C)+u+t.value.substring(S),setTimeout(()=>{_.selectionStart=_.selectionEnd=C+u.length,_.focus()},0)}else t.value+=u;c.value=!1},m=u=>{c.value&&!u.target.closest(".emoji-picker-popover")&&!u.target.closest(".emoji-picker-toggle")&&(c.value=!1)};return typeof window<"u"&&window.addEventListener("click",m),(u,_)=>(n(),l("div",Je,[e("div",We,[e("div",Xe,[I(e("textarea",{"onUpdate:modelValue":_[0]||(_[0]=C=>t.value=C),onKeypress:r,class:"w-full border-none focus:ring-0 resize-none bg-transparent text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400",placeholder:"メモを書く",rows:"1",disabled:s.value},null,40,Ye),[[K,t.value]]),c.value?(n(),l("div",et,[(n(),l(N,null,Q(k,C=>e("button",{key:C,class:"text-2xl p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",onClick:G(S=>a(C),["stop"]),type:"button"},b(C),9,tt)),64))])):$("",!0)]),e("div",st,[e("div",at,[e("button",rt,[v(d(ve),{class:"h-6 w-6"})]),e("button",ot,[v(d(xe),{class:"h-6 w-6"})]),e("button",nt,[v(d(ue),{class:"h-6 w-6"})])]),e("div",lt,[e("button",{class:"emoji-picker-toggle text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300",onClick:_[1]||(_[1]=G(C=>c.value=!c.value,["stop"])),title:"絵文字を挿入",type:"button"},[v(d(ie),{class:"h-6 w-6"})]),e("button",dt,[v(d(ne),{class:"h-6 w-6"})]),e("button",{onClick:p,disabled:!t.value.trim()||s.value,class:"bg-gray-800 text-white rounded p-1 hover:bg-gray-700 disabled:bg-gray-400 disabled:cursor-not-allowed",type:"button"},[v(d(ge),{class:"h-5 w-5"})],8,it)])])])]))}},ut={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},gt={class:"bg-white rounded-lg p-6 w-full max-w-md mx-4"},ht={class:"flex items-center justify-between mb-4"},vt={class:"mb-4"},mt=["disabled"],xt={key:0,class:"mt-2 text-red-600 text-sm"},yt={class:"flex justify-end space-x-3"},pt=["disabled"],ft=["disabled"],kt={__name:"MessageEditModal",props:{show:Boolean,message:Object},emits:["close","messageUpdated"],setup(o,{emit:i}){const h=o,y=i,t=f(""),s=f(!1),c=f("");H(()=>h.message,a=>{a&&(t.value=a.content,c.value="")},{immediate:!0});const k=async()=>{var a,m;if(!(!t.value.trim()||!h.message)){s.value=!0,c.value="";try{const u=await L.put(`/messages/${h.message.id}`,{content:t.value.trim()});y("messageUpdated",u.data),y("close")}catch(u){console.error("Message update failed:",u),(m=(a=u.response)==null?void 0:a.data)!=null&&m.message?c.value=u.response.data.message:c.value="メッセージの更新に失敗しました"}finally{s.value=!1}}},p=()=>{var a;t.value=((a=h.message)==null?void 0:a.content)||"",c.value="",y("close")},r=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),k())};return(a,m)=>o.show?(n(),l("div",ut,[e("div",gt,[e("div",ht,[m[1]||(m[1]=e("h3",{class:"text-lg font-semibold"},"メッセージを編集",-1)),e("button",{onClick:p,class:"text-gray-500 hover:text-gray-700"},[v(d(te),{class:"h-6 w-6"})])]),e("div",vt,[I(e("textarea",{"onUpdate:modelValue":m[0]||(m[0]=u=>t.value=u),onKeypress:r,class:"w-full border border-gray-300 rounded-lg p-3 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"メッセージを入力してください",rows:"4",disabled:s.value},null,40,mt),[[K,t.value]]),c.value?(n(),l("div",xt,b(c.value),1)):$("",!0)]),e("div",yt,[e("button",{onClick:p,class:"px-4 py-2 text-gray-600 hover:text-gray-800",disabled:s.value}," キャンセル ",8,pt),e("button",{onClick:k,disabled:!t.value.trim()||s.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center space-x-2"},[v(d(T),{class:"h-4 w-4"}),e("span",null,b(s.value?"更新中...":"更新"),1)],8,ft)])])])):$("",!0)}},wt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},bt={class:"bg-white rounded-lg p-6 w-full max-w-md mx-4"},_t={class:"flex items-center justify-between mb-4"},$t={class:"mb-4 text-gray-700"},Ct={class:"mt-2 p-2 bg-gray-100 rounded text-gray-800"},Mt={key:0,class:"mt-2 text-red-600 text-sm"},jt={class:"flex justify-end space-x-3"},Lt=["disabled"],St=["disabled"],Bt={__name:"MessageDeleteModal",props:{show:Boolean,message:Object},emits:["close","messageDeleted"],setup(o,{emit:i}){const h=o,y=i,t=f(!1),s=f(""),c=async()=>{var p,r;if(h.message){t.value=!0,s.value="";try{await L.delete(`/messages/${h.message.id}`),y("messageDeleted",h.message.id),y("close")}catch(a){s.value=((r=(p=a.response)==null?void 0:p.data)==null?void 0:r.message)||"削除に失敗しました"}finally{t.value=!1}}},k=()=>{s.value="",y("close")};return(p,r)=>{var a;return o.show?(n(),l("div",wt,[e("div",bt,[e("div",_t,[r[0]||(r[0]=e("h3",{class:"text-lg font-semibold"},"メッセージを削除",-1)),e("button",{onClick:k,class:"text-gray-500 hover:text-gray-700"},[v(d(te),{class:"h-6 w-6"})])]),e("div",$t,[r[1]||(r[1]=R(" 本当にこのメッセージを削除しますか？ ")),e("div",Ct,b((a=o.message)==null?void 0:a.content),1),s.value?(n(),l("div",Mt,b(s.value),1)):$("",!0)]),e("div",jt,[e("button",{onClick:k,class:"px-4 py-2 text-gray-600 hover:text-gray-800",disabled:t.value}," キャンセル ",8,Lt),e("button",{onClick:c,disabled:t.value,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center space-x-2"},[v(d(me),{class:"h-4 w-4"}),e("span",null,b(t.value?"削除中...":"削除"),1)],8,St)])])])):$("",!0)}}},Et={class:"flex-1 flex flex-col bg-white dark:bg-gray-900"},At={class:"flex-1 p-6 overflow-y-auto"},Dt={class:"flex-1"},Ut={class:"flex items-center justify-between"},Tt={class:"font-bold text-gray-900 dark:text-gray-100"},Vt={class:"text-xs text-gray-500 dark:text-gray-400 font-normal ml-2"},Ot={class:"flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity"},Zt=["onClick"],zt=["onClick"],Ht={class:"text-gray-800 dark:text-gray-200"},Ft={__name:"MainContent",props:{messages:{type:Array,default:()=>[]},activeChannel:Object},emits:["messageSent","messageUpdated","messageDeleted"],setup(o,{emit:i}){var B;const y=(B=ee().props.auth)==null?void 0:B.user,t=o,s=i,c=f([...t.messages||[]]),k=f(!1),p=f(null),r=f(!1),a=f(null);H(()=>t.messages,w=>{c.value=[...w||[]]},{deep:!0});const m=w=>{c.value.unshift(w),s("messageSent",w)},u=w=>{const x=c.value.findIndex(g=>g.id===w.id);x!==-1&&(c.value[x]=w),s("messageUpdated",w)},_=w=>{const x=c.value.findIndex(g=>g.id===w);x!==-1&&c.value.splice(x,1),s("messageDeleted",w)},C=w=>{p.value=w,k.value=!0},S=()=>{k.value=!1,p.value=null},V=w=>{a.value=w,r.value=!0},O=()=>{r.value=!1,a.value=null},A=w=>y&&w.user.id===y.id;return(w,x)=>(n(),l("div",Et,[v(Ge,{"active-channel":o.activeChannel},null,8,["active-channel"]),e("div",At,[(n(!0),l(N,null,Q(c.value,g=>(n(),l("div",{key:g.id,class:"flex items-start mb-4 group hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg p-2 -m-2"},[x[1]||(x[1]=e("div",{class:"w-10 h-10 rounded bg-purple-400 mr-4 shrink-0"},null,-1)),e("div",Dt,[e("div",Ut,[e("p",Tt,[R(b(g.user.name)+" ",1),e("span",Vt,b(g.time),1)]),e("div",Ot,[A(g)?(n(),l("button",{key:0,onClick:j=>C(g),class:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 p-1 rounded",title:"メッセージを編集"},[v(d(he),{class:"h-4 w-4"})],8,Zt)):$("",!0),A(g)?(n(),l("button",{key:1,onClick:j=>V(g),class:"text-red-500 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 p-1 rounded",title:"メッセージを削除"},x[0]||(x[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,zt)):$("",!0)])]),e("p",Ht,b(g.content),1)])]))),128))]),v(ct,{"active-channel":o.activeChannel,onMessageSent:m},null,8,["active-channel"]),v(kt,{show:k.value,message:p.value,onClose:S,onMessageUpdated:u},null,8,["show","message"]),v(Bt,{show:r.value,message:a.value,onClose:O,onMessageDeleted:_},null,8,["show","message"])]))}},It={class:"flex h-screen bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200"},Kt={class:"flex-1 flex flex-col"},Pt={__name:"AppLayout",props:{title:String,channels:Array,"direct-messages":Array,messages:Array,activeChannel:Object,manualOffline:Boolean},emits:["selectChannel","newChannelAdded","messageSent","messageUpdated","messageDeleted","toggleManualOffline","channelDeleted","channelLeft"],setup(o,{emit:i}){const h=i;return(y,t)=>(n(),l("div",null,[v(d(se),{title:o.title},null,8,["title"]),e("div",It,[v(re),v(oe,{channels:o.channels,"direct-messages":y.direct-o.messages,"manual-offline":o.manualOffline,onToggleManualOffline:t[0]||(t[0]=s=>h("toggleManualOffline",s)),onSelectChannel:t[1]||(t[1]=s=>h("selectChannel",s)),onNewChannelAdded:t[2]||(t[2]=s=>h("newChannelAdded",s)),onChannelDeleted:t[3]||(t[3]=s=>h("channelDeleted",s)),onChannelLeft:t[4]||(t[4]=s=>h("channelLeft",s))},null,8,["channels","direct-messages","manual-offline"]),e("div",Kt,[J(y.$slots,"notifications"),J(y.$slots,"default"),v(Ft,{messages:o.messages,"active-channel":o.activeChannel,onMessageSent:t[5]||(t[5]=s=>h("messageSent",s)),onMessageUpdated:t[6]||(t[6]=s=>h("messageUpdated",s)),onMessageDeleted:t[7]||(t[7]=s=>h("messageDeleted",s))},null,8,["messages","active-channel"])])])]))}};export{Pt as _};
