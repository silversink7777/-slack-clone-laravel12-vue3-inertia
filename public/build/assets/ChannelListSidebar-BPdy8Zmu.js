import{e as o,o as a,a as t,d as g,q as R,A as P,b as x,f as C,u as k,t as p,z as T,Q,j as Z,k as F,v as D,C as z,c as J,w as B,D as W,g as y,F as M,h as U,l as X,s as H,n as N}from"./app-PgSOKnUn.js";import{_ as G}from"./Modal-BHW6xvs7.js";import{_ as q}from"./PrimaryButton-BNhFOszE.js";import{_ as Y}from"./SecondaryButton-CtUa-bff.js";function ee(v,d){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 0 1-5.714 0m5.714 0a3 3 0 1 1-5.714 0"})])}function Ke(v,d){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"})])}function Re(v,d){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})])}const te={class:"w-20 bg-slack-purple-darker text-white p-2"},ne={key:0,class:"absolute -top-1 -right-1 bg-red-500 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center min-w-[20px]"},Pe={__name:"WorkspaceSidebar",setup(v){const d=g(0);let m=null;const c=async()=>{try{const u=await T.get("/my-invitations");u.data&&Array.isArray(u.data)&&(d.value=u.data.length)}catch(u){console.error("Failed to fetch invitation count:",u),d.value=0}},r=()=>{m&&clearInterval(m),m=setInterval(c,3e4)},f=()=>{Q.visit("/invitations")};return R(()=>{c(),r(),window.addEventListener("invitation-count-updated",c)}),P(()=>{m&&clearInterval(m),window.removeEventListener("invitation-count-updated",c)}),(u,l)=>(a(),o("div",te,[l[0]||(l[0]=t("div",{class:"rounded-lg bg-white text-purple-900 w-12 h-12 flex items-center justify-center text-2xl font-bold mb-4"}," T ",-1)),t("button",{onClick:f,class:"relative w-12 h-12 rounded-lg hover:bg-purple-700 flex items-center justify-center mb-2 transition-colors",title:"招待通知"},[x(k(ee),{class:"h-6 w-6"}),d.value>0?(a(),o("div",ne,p(d.value>99?"99+":d.value),1)):C("",!0)])]))}};function O(v,d){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M12.53 16.28a.75.75 0 0 1-1.06 0l-7.5-7.5a.75.75 0 0 1 1.06-1.06L12 14.69l6.97-6.97a.75.75 0 1 1 1.06 1.06l-7.5 7.5Z","clip-rule":"evenodd"})])}function se(v,d){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M11.097 1.515a.75.75 0 0 1 .589.882L10.666 7.5h4.47l1.079-5.397a.75.75 0 1 1 1.47.294L16.665 7.5h3.585a.75.75 0 0 1 0 1.5h-3.885l-1.2 6h3.585a.75.75 0 0 1 0 1.5h-3.885l-1.08 5.397a.75.75 0 1 1-1.47-.294l1.02-5.103h-4.47l-1.08 5.397a.75.75 0 1 1-1.47-.294l1.02-5.103H3.75a.75.75 0 0 1 0-1.5h3.885l1.2-6H5.25a.75.75 0 0 1 0-1.5h3.885l1.08-5.397a.75.75 0 0 1 .882-.588ZM10.365 9l-1.2 6h4.47l1.2-6h-4.47Z","clip-rule":"evenodd"})])}function le(v,d){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{"fill-rule":"evenodd",d:"M12 3.75a.75.75 0 0 1 .75.75v6.75h6.75a.75.75 0 0 1 0 1.5h-6.75v6.75a.75.75 0 0 1-1.5 0v-6.75H4.5a.75.75 0 0 1 0-1.5h6.75V4.5a.75.75 0 0 1 .75-.75Z","clip-rule":"evenodd"})])}function ae(v,d){return a(),o("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon"},[t("path",{d:"M5.25 6.375a4.125 4.125 0 1 1 8.25 0 4.125 4.125 0 0 1-8.25 0ZM2.25 19.125a7.125 7.125 0 0 1 14.25 0v.003l-.001.119a.75.75 0 0 1-.363.63 13.067 13.067 0 0 1-6.761 1.873c-2.472 0-4.786-.684-6.76-1.873a.75.75 0 0 1-.364-.63l-.001-.122ZM18.75 7.5a.75.75 0 0 0-1.5 0v2.25H15a.75.75 0 0 0 0 1.5h2.25v2.25a.75.75 0 0 0 1.5 0v-2.25H21a.75.75 0 0 0 0-1.5h-2.25V7.5Z"})])}const oe={class:"bg-white rounded-lg p-6 w-full max-w-md"},re={__name:"AddChannelModal",props:{show:Boolean},emits:["createChannel","close"],setup(v,{emit:d}){const m=d,c=g(""),r=()=>{c.value.trim()&&(m("createChannel",c.value.trim()),c.value="")},f=()=>{m("close")};return(u,l)=>v.show?(a(),o("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center",onClick:Z(f,["self"])},[t("div",oe,[l[3]||(l[3]=t("h2",{class:"text-lg font-bold mb-4"},"新しいチャンネルを作成する",-1)),t("form",{onSubmit:Z(r,["prevent"])},[t("div",null,[l[1]||(l[1]=t("label",{for:"channel-name",class:"block text-sm font-medium text-gray-700"},"チャンネル名",-1)),F(t("input",{"onUpdate:modelValue":l[0]||(l[0]=b=>c.value=b),type:"text",id:"channel-name",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",placeholder:"# e.g. 新規プロジェクト",required:""},null,512),[[D,c.value]])]),t("div",{class:"mt-6 flex justify-end space-x-4"},[t("button",{type:"button",onClick:f,class:"px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300"}," キャンセル "),l[2]||(l[2]=t("button",{type:"submit",class:"px-4 py-2 bg-slack-purple-dark text-white rounded-md hover:bg-slack-purple-darker"}," 作成する ",-1))])],32)])])):C("",!0)}},ie={class:"p-6"},ue={class:"mb-6 p-4 bg-gray-50 rounded-lg"},de={class:"space-y-3"},ce={class:"flex space-x-2"},ve={key:0,class:"space-y-2"},me={class:"block text-sm font-medium text-gray-700"},fe={class:"flex flex-wrap gap-2"},he=["onClick"],pe={class:"mb-4"},ge={class:"space-y-2 max-h-60 overflow-y-auto"},xe=["id","value"],be=["for"],we={class:"font-medium text-gray-900"},ye={class:"text-sm text-gray-500"},_e={key:0,class:"mb-4"},ke={class:"block text-sm font-medium text-gray-700 mb-2"},Ce={class:"flex flex-wrap gap-2"},$e=["onClick"],Me={key:1,class:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded"},Ue={key:2,class:"mb-4 p-3 bg-green-100 border border-green-400 text-green-700 rounded"},je={class:"flex justify-end space-x-3"},Ae={__name:"InviteUsersModal",props:{show:{type:Boolean,default:!1},channelId:{type:[String,Number],default:0},currentUsers:{type:Array,default:()=>[]}},emits:["close","invitations-sent"],setup(v,{emit:d}){const m=v,c=d,r=g([]),f=g([]),u=g(""),l=g([]),b=g(!1),i=g(""),_=g(""),S=async()=>{try{const n=await fetch("/users"),e=await n.json();n.ok?f.value=e.data.filter(s=>!m.currentUsers.some(h=>h.id===s.id)):i.value=e.message||"ユーザー一覧の取得に失敗しました"}catch(n){i.value="ユーザー一覧の取得に失敗しました",console.error("Load users error:",n)}},j=n=>{const e=f.value.find(s=>s.id===n);return e?e.name:"Unknown User"},V=n=>{r.value=r.value.filter(e=>e!==n)},A=()=>{const n=u.value.trim();if(!n)return;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)){i.value="有効なメールアドレスを入力してください";return}if(l.value.includes(n)){i.value="このメールアドレスは既に追加されています";return}if(f.value.find(w=>w.email===n)){i.value="このメールアドレスのユーザーは既に選択可能なユーザーリストに含まれています。ユーザーリストから選択してください。";return}if(r.value.map(w=>{const I=f.value.find(K=>K.id===w);return I?I.email:null}).filter(w=>w).includes(n)){i.value="このメールアドレスのユーザーは既に選択されています";return}l.value.push(n),u.value="",i.value=""},E=n=>{l.value.splice(n,1)},L=async()=>{if(!(r.value.length===0&&l.value.length===0)){b.value=!0,i.value="",_.value="";try{const n=await fetch(`/channels/${m.channelId}/invite`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({user_ids:r.value,emails:l.value})}),e=await n.json();if(n.ok){const s=r.value.length+l.value.length;_.value=`${s}件の招待を送信しました`,r.value=[],l.value=[],c("invitations-sent",e),setTimeout(()=>{$()},2e3)}else i.value=e.message||"招待の送信に失敗しました"}catch(n){i.value="招待の送信に失敗しました",console.error("Invitation error:",n)}finally{b.value=!1}}},$=()=>{r.value=[],l.value=[],u.value="",i.value="",_.value="",c("close")};return z(()=>m.show,n=>{n&&(i.value="",_.value="",S())}),(n,e)=>(a(),J(G,{show:v.show,onClose:$},{default:B(()=>[t("div",ie,[e[8]||(e[8]=t("h2",{class:"text-lg font-medium text-gray-900 mb-4"}," ユーザーを招待 ",-1)),t("div",ue,[e[3]||(e[3]=t("h3",{class:"text-md font-medium text-gray-900 mb-3"}," メールアドレスで招待 ",-1)),t("div",de,[t("div",ce,[F(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>u.value=s),type:"email",placeholder:"メールアドレスを入力",class:"flex-1 rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500",onKeyup:W(A,["enter"])},null,544),[[D,u.value]]),x(q,{onClick:A,disabled:!u.value.trim()||b.value,class:"px-4"},{default:B(()=>e[2]||(e[2]=[y(" 追加 ")])),_:1,__:[2]},8,["disabled"])]),l.value.length>0?(a(),o("div",ve,[t("label",me," 招待するメールアドレス ("+p(l.value.length)+"件) ",1),t("div",fe,[(a(!0),o(M,null,U(l.value,(s,h)=>(a(),o("span",{key:h,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},[y(p(s)+" ",1),t("button",{onClick:w=>E(h),class:"ml-1 inline-flex items-center justify-center w-4 h-4 rounded-full text-blue-400 hover:bg-blue-200 hover:text-blue-500"}," × ",8,he)]))),128))])])):C("",!0)])]),t("div",pe,[e[4]||(e[4]=t("h3",{class:"text-md font-medium text-gray-900 mb-3"}," 既存ユーザーを選択 ",-1)),e[5]||(e[5]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," 招待するユーザーを選択 ",-1)),t("div",ge,[(a(!0),o(M,null,U(f.value,s=>(a(),o("div",{key:s.id,class:"flex items-center space-x-3 p-2 border rounded hover:bg-gray-50"},[F(t("input",{type:"checkbox",id:"user-"+s.id,value:s.id,"onUpdate:modelValue":e[1]||(e[1]=h=>r.value=h),class:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"},null,8,xe),[[X,r.value]]),t("label",{for:"user-"+s.id,class:"flex-1 cursor-pointer"},[t("div",we,p(s.name),1),t("div",ye,p(s.email),1)],8,be)]))),128))])]),r.value.length>0?(a(),o("div",_e,[t("label",ke," 選択されたユーザー ("+p(r.value.length)+"人) ",1),t("div",Ce,[(a(!0),o(M,null,U(r.value,s=>(a(),o("span",{key:s,class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800"},[y(p(j(s))+" ",1),t("button",{onClick:h=>V(s),class:"ml-1 inline-flex items-center justify-center w-4 h-4 rounded-full text-indigo-400 hover:bg-indigo-200 hover:text-indigo-500"}," × ",8,$e)]))),128))])])):C("",!0),i.value?(a(),o("div",Me,p(i.value),1)):C("",!0),_.value?(a(),o("div",Ue,p(_.value),1)):C("",!0),t("div",je,[x(Y,{onClick:$},{default:B(()=>e[6]||(e[6]=[y(" キャンセル ")])),_:1,__:[6]}),x(q,{onClick:L,disabled:r.value.length===0&&l.value.length===0||b.value,loading:b.value},{default:B(()=>e[7]||(e[7]=[y(" 招待を送信 ")])),_:1,__:[7]},8,["disabled","loading"])])])]),_:1},8,["show"]))}},Ie={class:"w-64 bg-slack-purple-dark text-slack-purple-light flex flex-col"},Be={class:"px-4 h-16 flex items-center justify-between font-bold text-white text-lg border-b border-purple-800"},Se={class:"flex items-center space-x-2"},Ve={class:"flex-1 overflow-y-auto p-2"},Ee={class:"mb-4"},Le={class:"flex items-center justify-between px-2"},Ne={class:"text-sm font-bold flex items-center"},Oe=["onClick"],Te=["onClick","title"],Ze={class:"mb-4"},Fe={class:"text-sm font-bold px-2 flex items-center"},Qe={__name:"ChannelListSidebar",props:{channels:Array,"direct-messages":Array,manualOffline:Boolean},emits:["selectChannel","newChannelAdded","toggleManualOffline"],setup(v,{emit:d}){const m=v,c=H(()=>m.channels||[]),r=H(()=>m["direct-messages"]||[]),f=d,u=g(!1),l=g(!1),b=g(0),i=g({}),_=n=>{f("selectChannel",n)},S=async n=>{try{const e=await T.post("/channels",{name:n});f("newChannelAdded",e.data),u.value=!1}catch(e){console.error("Channel creation failed:",e)}},j=async n=>{try{const e=await T.get(`/channels/${n}/members`);return i.value[n]=e.data,e.data}catch(e){return console.error("Error fetching channel members:",e),i.value[n]=[],[]}},V=async()=>{if(c.value.length===0)return;const n=c.value.map(async e=>{i.value[e.id]||await j(e.id)});await Promise.all(n)};z(c,async n=>{n.length>0&&await V()},{immediate:!0});const A=async n=>{b.value=n,i.value[n]||await j(n),l.value=!0},E=n=>{A(n)},L=n=>{},$=n=>{var w;const e=(w=document.querySelector('meta[name="user-id"]'))==null?void 0:w.content;if(!e)return!1;const h=(i.value[n]||[]).find(I=>I.id===parseInt(e));return h&&h.role==="admin"};return(n,e)=>(a(),o("div",Ie,[t("div",Be,[e[4]||(e[4]=t("span",null,"test",-1)),t("div",Se,[t("span",{class:N([v.manualOffline?"bg-gray-400":"bg-green-500","h-3 w-3 rounded-full inline-block"])},null,2),t("button",{onClick:e[0]||(e[0]=s=>f("toggleManualOffline",!v.manualOffline)),class:"text-xs bg-gray-700 px-2 py-1 rounded hover:bg-gray-600"},p(v.manualOffline?"オフライン中":"オンライン中"),1)]),x(k(O),{class:"h-5 w-5"})]),t("div",Ve,[t("div",Ee,[t("div",Le,[t("h2",Ne,[x(k(O),{class:"h-4 w-4 mr-1"}),e[5]||(e[5]=y(" チャンネル "))]),t("button",{onClick:e[1]||(e[1]=s=>u.value=!0),class:"text-slack-purple-light hover:text-white"},[x(k(le),{class:"h-4 w-4"})])]),t("ul",null,[(a(!0),o(M,null,U(c.value,s=>(a(),o("li",{key:s.id,class:N(["group flex items-center justify-between rounded px-2 py-1",{"text-slack-active-item-text bg-slack-active-item":s.active,"hover:bg-purple-600":!s.active}])},[t("div",{onClick:h=>_(s.id),class:"flex items-center flex-1 cursor-pointer"},[x(k(se),{class:"h-5 w-5 mr-2"}),y(" "+p(s.name),1)],8,Oe),$(s.id)?(a(),o("button",{key:0,onClick:Z(h=>E(s.id),["stop"]),class:"text-slack-purple-light hover:text-white ml-2 transition-opacity",title:`${s.name}にユーザーを招待`},[x(k(ae),{class:"h-4 w-4"})],8,Te)):C("",!0)],2))),128))])]),t("div",Ze,[t("h2",Fe,[x(k(O),{class:"h-4 w-4 mr-1"}),y(" ダイレクトメッセージ ("+p(r.value.length)+") ",1)]),t("ul",null,[(a(!0),o(M,null,U(r.value,s=>(a(),o("li",{key:s.id,class:"flex items-center rounded px-2 py-1 hover:bg-purple-600 cursor-pointer"},[t("span",{class:N(["h-3 w-3 rounded-full mr-2",{"bg-green-500":!!s.online,"bg-gray-400":!s.online}])},null,2),y(" "+p(s.name),1)]))),128))])])]),x(re,{show:u.value,onCreateChannel:S,onClose:e[2]||(e[2]=s=>u.value=!1)},null,8,["show"]),x(Ae,{show:l.value,"channel-id":b.value,"current-users":i.value[b.value]||[],onClose:e[3]||(e[3]=s=>l.value=!1),onInvitationsSent:L},null,8,["show","channel-id","current-users"])]))}};export{Pe as _,Qe as a,Re as b,Ke as r};
