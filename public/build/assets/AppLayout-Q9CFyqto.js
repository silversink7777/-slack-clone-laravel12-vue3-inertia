import{e as d,o as n,a as e,d as p,B as H,q as F,z as M,A as J,f as _,c as L,b as v,u as l,t as b,n as Z,C as W,k as I,v as K,g as R,F as X,h as Y,Q,p as te,r as q}from"./app-DqKEGhBu.js";import{r as z,a as se,_ as ae,b as re}from"./ChannelListSidebar-Jv3fuKHF.js";function oe(o,i){return n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 12a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm0 0c0 1.657 1.007 3 2.25 3S21 13.657 21 12a9 9 0 1 0-2.636 6.364M16.5 12V8.25"})])}function U(o,i){return n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}function ne(o,i){return n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function le(o,i){return n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 17.25v1.007a3 3 0 0 1-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0 1 15 18.257V17.25m6-12V15a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 15V5.25m18 0A2.25 2.25 0 0 0 18.75 3H5.25A2.25 2.25 0 0 0 3 5.25m18 0V12a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 12V5.25"})])}function de(o,i){return n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.182 15.182a4.5 4.5 0 0 1-6.364 0M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Z"})])}function ie(o,i){return n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}function ce(o,i){return n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z"})])}function P(o,i){return n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"})])}function ue(o,i){return n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})])}function ge(o,i){return n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"})])}function he(o,i){return n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})])}function G(o,i){return n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"})])}function ve(o,i){return n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})])}function me(o,i){return n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"})])}function ee(o,i){return n(),d("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})])}function xe(){const o=p("system"),i=p(!1),u=p(!1),x=()=>window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",s=r=>{(r==="system"?x():r)==="dark"?(document.documentElement.classList.add("dark"),i.value=!0):(document.documentElement.classList.remove("dark"),i.value=!1)},t=async()=>{try{const r=await M.get("/api/auth/check");return console.log("Auth status:",r.data),r.data.authenticated}catch(r){return console.error("Failed to check auth status:",r),!1}},g=async()=>{var r,a;try{u.value=!0,console.log("Loading theme...");const y=await t();console.log("Is authenticated:",y);const k=await M.get("/theme");console.log("Theme loaded successfully:",k.data),o.value=k.data.theme,s(o.value)}catch(y){console.error("Failed to load theme:",y),console.error("Error response:",(r=y.response)==null?void 0:r.data),console.error("Error status:",(a=y.response)==null?void 0:a.status),o.value="system",s("system")}finally{u.value=!1}},f=async r=>{var a,y;try{u.value=!0,console.log("Updating theme to:",r);const k=await t();console.log("Is authenticated:",k),await M.post("/theme",{theme:r}),console.log("Theme updated successfully"),o.value=r,s(r)}catch(k){throw console.error("Failed to update theme:",k),console.error("Error response:",(a=k.response)==null?void 0:a.data),console.error("Error status:",(y=k.response)==null?void 0:y.status),k}finally{u.value=!1}},h=()=>{window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{o.value==="system"&&s("system")})};return H(o,r=>{s(r)}),F(()=>{g(),h()}),{theme:o,isDark:i,isLoading:u,updateTheme:f,loadTheme:g}}const ye={class:"relative"},pe=["disabled"],fe={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},ke={key:0,class:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50"},we={class:"py-1"},be={__name:"ThemeToggle",setup(o){const{theme:i,isDark:u,isLoading:x,updateTheme:s}=xe(),t=p(!1),g=r=>{switch(r){case"light":return"ライト";case"dark":return"ダーク";case"system":return"システム";default:return"システム"}},f=async r=>{try{await s(r),t.value=!1}catch(a){console.error("Failed to update theme:",a),alert("テーマの更新に失敗しました")}},h=r=>{r.target.closest(".relative")||(t.value=!1)};return F(()=>{document.addEventListener("click",h)}),J(()=>{document.removeEventListener("click",h)}),(r,a)=>(n(),d("div",ye,[e("button",{onClick:a[0]||(a[0]=y=>t.value=!t.value),class:"flex items-center space-x-2 px-3 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",disabled:l(x)},[l(u)?(n(),L(l(G),{key:0,class:"h-5 w-5 text-yellow-500"})):(n(),L(l(P),{key:1,class:"h-5 w-5 text-gray-600 dark:text-gray-400"})),e("span",fe,b(g(l(i))),1),v(l(z),{class:"h-4 w-4 text-gray-500 dark:text-gray-400"})],8,pe),t.value?(n(),d("div",ke,[e("div",we,[e("button",{onClick:a[1]||(a[1]=y=>f("light")),class:Z(["w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",{"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":l(i)==="light"}])},[v(l(G),{class:"h-4 w-4"}),a[4]||(a[4]=e("span",null,"ライト",-1)),l(i)==="light"?(n(),L(l(U),{key:0,class:"h-4 w-4 ml-auto"})):_("",!0)],2),e("button",{onClick:a[2]||(a[2]=y=>f("dark")),class:Z(["w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",{"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":l(i)==="dark"}])},[v(l(P),{class:"h-4 w-4"}),a[5]||(a[5]=e("span",null,"ダーク",-1)),l(i)==="dark"?(n(),L(l(U),{key:0,class:"h-4 w-4 ml-auto"})):_("",!0)],2),e("button",{onClick:a[3]||(a[3]=y=>f("system")),class:Z(["w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",{"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":l(i)==="system"}])},[v(l(le),{class:"h-4 w-4"}),a[6]||(a[6]=e("span",null,"システム",-1)),l(i)==="system"?(n(),L(l(U),{key:0,class:"h-4 w-4 ml-auto"})):_("",!0)],2)])])):_("",!0)]))}},_e={class:"h-16 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex items-center justify-between px-6"},$e={class:"flex items-center font-bold text-gray-900 dark:text-gray-100"},Ce={class:"flex items-center space-x-4"},Me={class:"relative search-container"},je={key:1,class:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 max-h-96 overflow-y-auto z-50"},Le={key:0,class:"p-4 text-center text-gray-500"},Be={key:1,class:"p-4 text-center text-red-500"},Se={key:2,class:"py-2"},Ae=["onClick"],De={class:"flex items-start space-x-3"},Ue={class:"flex-shrink-0"},Ee={class:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center"},Te={class:"text-sm font-medium text-gray-600"},Ve={class:"flex-1 min-w-0"},Oe={class:"flex items-center space-x-2"},Ze={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},ze={class:"text-xs text-gray-500 dark:text-gray-400"},He={class:"text-xs text-gray-400 dark:text-gray-500"},Fe={class:"mt-1 text-sm text-gray-700 dark:text-gray-300"},Ie=["innerHTML"],Ke={key:3,class:"p-4 text-center text-gray-500"},Re={class:"text-sm font-medium"},Ne={key:0,class:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-50 border border-gray-200 dark:border-gray-700"},Qe=["href"],qe=["src","alt"],Pe={__name:"MainHeader",props:{activeChannel:Object},setup(o){var w;const u=(w=W().props.auth)==null?void 0:w.user,x=p(!1),s=p(null),t=p(""),g=p([]),f=p(!1),h=p(!1),r=p("");function a(m,c){let C;return function(...A){const D=()=>{C=null,m.apply(this,A)};clearTimeout(C),C=setTimeout(D,c)}}const y=a(async m=>{if(!m.trim()){g.value=[],h.value=!1;return}f.value=!0,r.value="";try{const c=await M.get("/messages/search",{params:{q:m.trim()}});g.value=c.data.messages,h.value=!0}catch(c){console.error("Search error:",c),r.value="検索中にエラーが発生しました",g.value=[]}finally{f.value=!1}},300),k=()=>{y(t.value)},B=()=>{t.value="",g.value=[],h.value=!1,r.value=""},E=m=>{Q.visit(`/dashboard?channel=${m.channel.id}&message=${m.id}`),B()},T=(m,c)=>{if(!c)return m;const C=new RegExp(`(${c})`,"gi");return m.replace(C,'<mark class="bg-yellow-200 text-black px-1 rounded">$1</mark>')},V=()=>{Q.post(route("logout"))},O=()=>{x.value=!x.value},S=()=>{x.value=!1},j=m=>{s.value&&!s.value.contains(m.target)&&S();const c=document.querySelector(".search-container");c&&!c.contains(m.target)&&(h.value=!1)};return F(()=>{document.addEventListener("click",j)}),J(()=>{document.removeEventListener("click",j)}),(m,c)=>{var C,A,D,N;return n(),d("div",_e,[e("div",null,[e("button",$e,[e("span",null,b((C=o.activeChannel)==null?void 0:C.name),1),v(l(z),{class:"h-5 w-5 ml-1"})])]),e("div",Ce,[v(be),v(l(ne),{class:"h-6 w-6 text-gray-500 dark:text-gray-400"}),e("div",Me,[v(l(ie),{class:"h-5 w-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),I(e("input",{"onUpdate:modelValue":c[0]||(c[0]=$=>t.value=$),onInput:k,onFocus:c[1]||(c[1]=$=>h.value=!0),type:"text",placeholder:"メッセージを検索する",class:"bg-gray-100 dark:bg-gray-700 rounded-md w-80 pl-10 pr-8 py-1.5 focus:ring-blue-500 focus:border-blue-500 border-transparent text-gray-900 dark:text-gray-100"},null,544),[[K,t.value]]),t.value?(n(),d("button",{key:0,onClick:B,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",title:"検索をクリア"},c[2]||(c[2]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):_("",!0),h.value&&(g.value.length>0||f.value||r.value)?(n(),d("div",je,[f.value?(n(),d("div",Le,c[3]||(c[3]=[e("div",{class:"flex items-center justify-center"},[e("svg",{class:"animate-spin h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),R(" 検索中... ")],-1)]))):r.value?(n(),d("div",Be,b(r.value),1)):g.value.length>0?(n(),d("div",Se,[(n(!0),d(X,null,Y(g.value,$=>(n(),d("div",{key:$.id,onClick:Ft=>E($),class:"px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-100 dark:border-gray-700 last:border-b-0"},[e("div",De,[e("div",Ue,[e("div",Ee,[e("span",Te,b($.user.name.charAt(0).toUpperCase()),1)])]),e("div",Ve,[e("div",Oe,[e("span",Ze,b($.user.name),1),e("span",ze,"#"+b($.channel.name),1),e("span",He,b($.date)+" "+b($.time),1)]),e("div",Fe,[e("span",{innerHTML:T($.content,t.value)},null,8,Ie)])])])],8,Ae))),128))])):(n(),d("div",Ke,' "'+b(t.value)+'" に一致するメッセージが見つかりませんでした ',1))])):_("",!0)]),e("div",{ref_key:"userMenuRef",ref:s,class:"relative"},[e("button",{onClick:O,class:"flex items-center space-x-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100 focus:outline-none"},[v(l(se),{class:"h-8 w-8"}),e("span",Re,b((A=l(u))==null?void 0:A.name),1),v(l(z),{class:"h-4 w-4"})]),x.value?(n(),d("div",Ne,[e("a",{href:m.route("profile.show"),class:"flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-700"},[e("img",{src:(D=l(u))==null?void 0:D.profile_photo_url,alt:(N=l(u))==null?void 0:N.name,class:"w-8 h-8 rounded-full object-cover mr-2 border border-gray-300 dark:border-gray-600"},null,8,qe),c[4]||(c[4]=e("span",null,"プロフィール",-1))],8,Qe),e("button",{onClick:V,class:"block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}," ログアウト ")])):_("",!0)],512)])])}}},Ge={class:"p-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700"},Je={class:"border border-gray-200 dark:border-gray-600 rounded-lg p-2 flex flex-col"},We=["disabled"],Xe={class:"flex items-center justify-between mt-2"},Ye={class:"flex items-center space-x-2"},et={class:"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},tt={class:"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},st={class:"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},at={class:"flex items-center space-x-2"},rt={class:"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},ot={class:"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},nt=["disabled"],lt={__name:"MessageInput",props:{activeChannel:Object},emits:["messageSent"],setup(o,{emit:i}){const u=o,x=i,s=p(""),t=p(!1),g=async()=>{if(!(!s.value.trim()||!u.activeChannel)){t.value=!0;try{const h=await M.post("/messages",{content:s.value.trim(),channel_id:u.activeChannel.id});x("messageSent",h.data),s.value=""}catch(h){console.error("Message sending failed:",h)}finally{t.value=!1}}},f=h=>{h.key==="Enter"&&!h.shiftKey&&(h.preventDefault(),g())};return(h,r)=>(n(),d("div",Ge,[e("div",Je,[I(e("textarea",{"onUpdate:modelValue":r[0]||(r[0]=a=>s.value=a),onKeypress:f,class:"w-full border-none focus:ring-0 resize-none bg-transparent text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400",placeholder:"メモを書く",rows:"1",disabled:t.value},null,40,We),[[K,s.value]]),e("div",Xe,[e("div",Ye,[e("button",et,[v(l(he),{class:"h-6 w-6"})]),e("button",tt,[v(l(me),{class:"h-6 w-6"})]),e("button",st,[v(l(ce),{class:"h-6 w-6"})])]),e("div",at,[e("button",rt,[v(l(de),{class:"h-6 w-6"})]),e("button",ot,[v(l(oe),{class:"h-6 w-6"})]),e("button",{onClick:g,disabled:!s.value.trim()||t.value,class:"bg-gray-800 text-white rounded p-1 hover:bg-gray-700 disabled:bg-gray-400 disabled:cursor-not-allowed"},[v(l(ue),{class:"h-5 w-5"})],8,nt)])])])]))}},dt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},it={class:"bg-white rounded-lg p-6 w-full max-w-md mx-4"},ct={class:"flex items-center justify-between mb-4"},ut={class:"mb-4"},gt=["disabled"],ht={key:0,class:"mt-2 text-red-600 text-sm"},vt={class:"flex justify-end space-x-3"},mt=["disabled"],xt=["disabled"],yt={__name:"MessageEditModal",props:{show:Boolean,message:Object},emits:["close","messageUpdated"],setup(o,{emit:i}){const u=o,x=i,s=p(""),t=p(!1),g=p("");H(()=>u.message,a=>{a&&(s.value=a.content,g.value="")},{immediate:!0});const f=async()=>{var a,y;if(!(!s.value.trim()||!u.message)){t.value=!0,g.value="";try{const k=await M.put(`/messages/${u.message.id}`,{content:s.value.trim()});x("messageUpdated",k.data),x("close")}catch(k){console.error("Message update failed:",k),(y=(a=k.response)==null?void 0:a.data)!=null&&y.message?g.value=k.response.data.message:g.value="メッセージの更新に失敗しました"}finally{t.value=!1}}},h=()=>{var a;s.value=((a=u.message)==null?void 0:a.content)||"",g.value="",x("close")},r=a=>{a.key==="Enter"&&!a.shiftKey&&(a.preventDefault(),f())};return(a,y)=>o.show?(n(),d("div",dt,[e("div",it,[e("div",ct,[y[1]||(y[1]=e("h3",{class:"text-lg font-semibold"},"メッセージを編集",-1)),e("button",{onClick:h,class:"text-gray-500 hover:text-gray-700"},[v(l(ee),{class:"h-6 w-6"})])]),e("div",ut,[I(e("textarea",{"onUpdate:modelValue":y[0]||(y[0]=k=>s.value=k),onKeypress:r,class:"w-full border border-gray-300 rounded-lg p-3 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"メッセージを入力してください",rows:"4",disabled:t.value},null,40,gt),[[K,s.value]]),g.value?(n(),d("div",ht,b(g.value),1)):_("",!0)]),e("div",vt,[e("button",{onClick:h,class:"px-4 py-2 text-gray-600 hover:text-gray-800",disabled:t.value}," キャンセル ",8,mt),e("button",{onClick:f,disabled:!s.value.trim()||t.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center space-x-2"},[v(l(U),{class:"h-4 w-4"}),e("span",null,b(t.value?"更新中...":"更新"),1)],8,xt)])])])):_("",!0)}},pt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ft={class:"bg-white rounded-lg p-6 w-full max-w-md mx-4"},kt={class:"flex items-center justify-between mb-4"},wt={class:"mb-4 text-gray-700"},bt={class:"mt-2 p-2 bg-gray-100 rounded text-gray-800"},_t={key:0,class:"mt-2 text-red-600 text-sm"},$t={class:"flex justify-end space-x-3"},Ct=["disabled"],Mt=["disabled"],jt={__name:"MessageDeleteModal",props:{show:Boolean,message:Object},emits:["close","messageDeleted"],setup(o,{emit:i}){const u=o,x=i,s=p(!1),t=p(""),g=async()=>{var h,r;if(u.message){s.value=!0,t.value="";try{await M.delete(`/messages/${u.message.id}`),x("messageDeleted",u.message.id),x("close")}catch(a){t.value=((r=(h=a.response)==null?void 0:h.data)==null?void 0:r.message)||"削除に失敗しました"}finally{s.value=!1}}},f=()=>{t.value="",x("close")};return(h,r)=>{var a;return o.show?(n(),d("div",pt,[e("div",ft,[e("div",kt,[r[0]||(r[0]=e("h3",{class:"text-lg font-semibold"},"メッセージを削除",-1)),e("button",{onClick:f,class:"text-gray-500 hover:text-gray-700"},[v(l(ee),{class:"h-6 w-6"})])]),e("div",wt,[r[1]||(r[1]=R(" 本当にこのメッセージを削除しますか？ ")),e("div",bt,b((a=o.message)==null?void 0:a.content),1),t.value?(n(),d("div",_t,b(t.value),1)):_("",!0)]),e("div",$t,[e("button",{onClick:f,class:"px-4 py-2 text-gray-600 hover:text-gray-800",disabled:s.value}," キャンセル ",8,Ct),e("button",{onClick:g,disabled:s.value,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center space-x-2"},[v(l(ve),{class:"h-4 w-4"}),e("span",null,b(s.value?"削除中...":"削除"),1)],8,Mt)])])])):_("",!0)}}},Lt={class:"flex-1 flex flex-col bg-white dark:bg-gray-900"},Bt={class:"flex-1 p-6 overflow-y-auto"},St={class:"flex-1"},At={class:"flex items-center justify-between"},Dt={class:"font-bold text-gray-900 dark:text-gray-100"},Ut={class:"text-xs text-gray-500 dark:text-gray-400 font-normal ml-2"},Et={class:"flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity"},Tt=["onClick"],Vt=["onClick"],Ot={class:"text-gray-800 dark:text-gray-200"},Zt={__name:"MainContent",props:{messages:{type:Array,default:()=>[]},activeChannel:Object},emits:["messageSent","messageUpdated","messageDeleted"],setup(o,{emit:i}){var j;const x=(j=W().props.auth)==null?void 0:j.user,s=o,t=i,g=p([...s.messages||[]]),f=p(!1),h=p(null),r=p(!1),a=p(null);H(()=>s.messages,w=>{g.value=[...w||[]]},{deep:!0});const y=w=>{g.value.unshift(w),t("messageSent",w)},k=w=>{const m=g.value.findIndex(c=>c.id===w.id);m!==-1&&(g.value[m]=w),t("messageUpdated",w)},B=w=>{const m=g.value.findIndex(c=>c.id===w);m!==-1&&g.value.splice(m,1),t("messageDeleted",w)},E=w=>{h.value=w,f.value=!0},T=()=>{f.value=!1,h.value=null},V=w=>{a.value=w,r.value=!0},O=()=>{r.value=!1,a.value=null},S=w=>x&&w.user.id===x.id;return(w,m)=>(n(),d("div",Lt,[v(Pe,{"active-channel":o.activeChannel},null,8,["active-channel"]),e("div",Bt,[(n(!0),d(X,null,Y(g.value,c=>(n(),d("div",{key:c.id,class:"flex items-start mb-4 group hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg p-2 -m-2"},[m[1]||(m[1]=e("div",{class:"w-10 h-10 rounded bg-purple-400 mr-4 shrink-0"},null,-1)),e("div",St,[e("div",At,[e("p",Dt,[R(b(c.user.name)+" ",1),e("span",Ut,b(c.time),1)]),e("div",Et,[S(c)?(n(),d("button",{key:0,onClick:C=>E(c),class:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 p-1 rounded",title:"メッセージを編集"},[v(l(ge),{class:"h-4 w-4"})],8,Tt)):_("",!0),S(c)?(n(),d("button",{key:1,onClick:C=>V(c),class:"text-red-500 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 p-1 rounded",title:"メッセージを削除"},m[0]||(m[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Vt)):_("",!0)])]),e("p",Ot,b(c.content),1)])]))),128))]),v(lt,{"active-channel":o.activeChannel,onMessageSent:y},null,8,["active-channel"]),v(yt,{show:f.value,message:h.value,onClose:T,onMessageUpdated:k},null,8,["show","message"]),v(jt,{show:r.value,message:a.value,onClose:O,onMessageDeleted:B},null,8,["show","message"])]))}},zt={class:"flex h-screen bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200"},Ht={class:"flex-1 flex flex-col"},Rt={__name:"AppLayout",props:{title:String,channels:Array,"direct-messages":Array,messages:Array,activeChannel:Object,manualOffline:Boolean},emits:["selectChannel","newChannelAdded","messageSent","messageUpdated","messageDeleted","toggleManualOffline","channelDeleted","channelLeft"],setup(o,{emit:i}){const u=i;return(x,s)=>(n(),d("div",null,[v(l(te),{title:o.title},null,8,["title"]),e("div",zt,[v(ae),v(re,{channels:o.channels,"direct-messages":x.direct-o.messages,"manual-offline":o.manualOffline,onToggleManualOffline:s[0]||(s[0]=t=>u("toggleManualOffline",t)),onSelectChannel:s[1]||(s[1]=t=>u("selectChannel",t)),onNewChannelAdded:s[2]||(s[2]=t=>u("newChannelAdded",t)),onChannelDeleted:s[3]||(s[3]=t=>u("channelDeleted",t)),onChannelLeft:s[4]||(s[4]=t=>u("channelLeft",t))},null,8,["channels","direct-messages","manual-offline"]),e("div",Ht,[q(x.$slots,"notifications"),q(x.$slots,"default"),v(Zt,{messages:o.messages,"active-channel":o.activeChannel,onMessageSent:s[5]||(s[5]=t=>u("messageSent",t)),onMessageUpdated:s[6]||(s[6]=t=>u("messageUpdated",t)),onMessageDeleted:s[7]||(s[7]=t=>u("messageDeleted",t))},null,8,["messages","active-channel"])])])]))}};export{Rt as _};
