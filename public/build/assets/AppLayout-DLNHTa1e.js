import{e as s,o as t,a as e,d as f,B as K,q as I,z as A,A as ee,f as C,c as O,b as m,u as c,t as b,n as z,C as te,k as P,v as N,g as Z,F as Q,h as W,Q as q,j as X,w as H,p as ae,r as G}from"./app-BYXUr5O4.js";import{r as R,a as re,_ as oe,b as ne}from"./ChannelListSidebar-DAEmN0w4.js";import{_ as le}from"./DialogModal-ou1ukYKz.js";function ie(i,u){return t(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 12a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm0 0c0 1.657 1.007 3 2.25 3S21 13.657 21 12a9 9 0 1 0-2.636 6.364M16.5 12V8.25"})])}function F(i,u){return t(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}function de(i,u){return t(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function ce(i,u){return t(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 17.25v1.007a3 3 0 0 1-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0 1 15 18.257V17.25m6-12V15a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 15V5.25m18 0A2.25 2.25 0 0 0 18.75 3H5.25A2.25 2.25 0 0 0 3 5.25m18 0V12a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 12V5.25"})])}function ue(i,u){return t(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.182 15.182a4.5 4.5 0 0 1-6.364 0M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Z"})])}function he(i,u){return t(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}function ge(i,u){return t(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z"})])}function J(i,u){return t(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"})])}function ve(i,u){return t(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})])}function me(i,u){return t(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"})])}function pe(i,u){return t(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})])}function Y(i,u){return t(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"})])}function fe(i,u){return t(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})])}function ye(i,u){return t(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"})])}function se(i,u){return t(),s("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})])}function xe(){const i=f("system"),u=f(!1),g=f(!1),k=()=>window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",a=n=>{(n==="system"?k():n)==="dark"?(document.documentElement.classList.add("dark"),u.value=!0):(document.documentElement.classList.remove("dark"),u.value=!1)},r=async()=>{try{const n=await A.get("/api/auth/check");return console.log("Auth status:",n.data),n.data.authenticated}catch(n){return console.error("Failed to check auth status:",n),!1}},h=async()=>{var n,l;try{g.value=!0,console.log("Loading theme...");const d=await r();console.log("Is authenticated:",d);const x=await A.get("/theme");console.log("Theme loaded successfully:",x.data),i.value=x.data.theme,a(i.value)}catch(d){console.error("Failed to load theme:",d),console.error("Error response:",(n=d.response)==null?void 0:n.data),console.error("Error status:",(l=d.response)==null?void 0:l.status),i.value="system",a("system")}finally{g.value=!1}},$=async n=>{var l,d;try{g.value=!0,console.log("Updating theme to:",n);const x=await r();console.log("Is authenticated:",x),await A.post("/theme",{theme:n}),console.log("Theme updated successfully"),i.value=n,a(n)}catch(x){throw console.error("Failed to update theme:",x),console.error("Error response:",(l=x.response)==null?void 0:l.data),console.error("Error status:",(d=x.response)==null?void 0:d.status),x}finally{g.value=!1}},v=()=>{window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{i.value==="system"&&a("system")})};return K(i,n=>{a(n)}),I(()=>{h(),v()}),{theme:i,isDark:u,isLoading:g,updateTheme:$,loadTheme:h}}const ke={class:"relative"},we=["disabled"],_e={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},be={key:0,class:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50"},$e={class:"py-1"},Ce={__name:"ThemeToggle",setup(i){const{theme:u,isDark:g,isLoading:k,updateTheme:a}=xe(),r=f(!1),h=n=>{switch(n){case"light":return"ライト";case"dark":return"ダーク";case"system":return"システム";default:return"システム"}},$=async n=>{try{await a(n),r.value=!1}catch(l){console.error("Failed to update theme:",l),alert("テーマの更新に失敗しました")}},v=n=>{n.target.closest(".relative")||(r.value=!1)};return I(()=>{document.addEventListener("click",v)}),ee(()=>{document.removeEventListener("click",v)}),(n,l)=>(t(),s("div",ke,[e("button",{onClick:l[0]||(l[0]=d=>r.value=!r.value),class:"flex items-center space-x-2 px-3 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",disabled:c(k)},[c(g)?(t(),O(c(Y),{key:0,class:"h-5 w-5 text-yellow-500"})):(t(),O(c(J),{key:1,class:"h-5 w-5 text-gray-600 dark:text-gray-400"})),e("span",_e,b(h(c(u))),1),m(c(R),{class:"h-4 w-4 text-gray-500 dark:text-gray-400"})],8,we),r.value?(t(),s("div",be,[e("div",$e,[e("button",{onClick:l[1]||(l[1]=d=>$("light")),class:z(["w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",{"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":c(u)==="light"}])},[m(c(Y),{class:"h-4 w-4"}),l[4]||(l[4]=e("span",null,"ライト",-1)),c(u)==="light"?(t(),O(c(F),{key:0,class:"h-4 w-4 ml-auto"})):C("",!0)],2),e("button",{onClick:l[2]||(l[2]=d=>$("dark")),class:z(["w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",{"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":c(u)==="dark"}])},[m(c(J),{class:"h-4 w-4"}),l[5]||(l[5]=e("span",null,"ダーク",-1)),c(u)==="dark"?(t(),O(c(F),{key:0,class:"h-4 w-4 ml-auto"})):C("",!0)],2),e("button",{onClick:l[3]||(l[3]=d=>$("system")),class:z(["w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",{"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":c(u)==="system"}])},[m(c(ce),{class:"h-4 w-4"}),l[6]||(l[6]=e("span",null,"システム",-1)),c(u)==="system"?(t(),O(c(F),{key:0,class:"h-4 w-4 ml-auto"})):C("",!0)],2)])])):C("",!0)]))}},Me={class:"h-16 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex items-center justify-between px-6"},je={class:"flex items-center font-bold text-gray-900 dark:text-gray-100"},Le={class:"flex items-center space-x-4"},Se={class:"relative search-container"},Be={key:1,class:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 max-h-96 overflow-y-auto z-50"},De={key:0,class:"p-4 text-center text-gray-500"},Ee={key:1,class:"p-4 text-center text-red-500"},Ae={key:2,class:"py-2"},Te=["onClick"],Ue={class:"flex items-start space-x-3"},Ve={class:"flex-shrink-0"},Oe={class:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center"},Fe={class:"text-sm font-medium text-gray-600"},Ze={class:"flex-1 min-w-0"},ze={class:"flex items-center space-x-2"},He={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Re={class:"text-xs text-gray-500 dark:text-gray-400"},Ke={class:"text-xs text-gray-400 dark:text-gray-500"},Ie={class:"mt-1 text-sm text-gray-700 dark:text-gray-300"},Pe=["innerHTML"],Ne={key:3,class:"p-4 text-center text-gray-500"},Qe={class:"text-sm font-medium"},We={key:0,class:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-50 border border-gray-200 dark:border-gray-700"},qe=["href"],Xe=["src","alt"],Ge={__name:"MainHeader",props:{activeChannel:Object},setup(i){var E;const g=(E=te().props.auth)==null?void 0:E.user,k=f(!1),a=f(null),r=f(""),h=f([]),$=f(!1),v=f(!1),n=f("");function l(j,w){let D;return function(...y){const S=()=>{D=null,j.apply(this,y)};clearTimeout(D),D=setTimeout(S,w)}}const d=l(async j=>{if(!j.trim()){h.value=[],v.value=!1;return}$.value=!0,n.value="";try{const w=await A.get("/messages/search",{params:{q:j.trim()}});h.value=w.data.messages,v.value=!0}catch(w){console.error("Search error:",w),n.value="検索中にエラーが発生しました",h.value=[]}finally{$.value=!1}},300),x=()=>{d(r.value)},T=()=>{r.value="",h.value=[],v.value=!1,n.value=""},U=j=>{q.visit(`/dashboard?channel=${j.channel.id}&message=${j.id}`),T()},V=(j,w)=>{if(!w)return j;const D=new RegExp(`(${w})`,"gi");return j.replace(D,'<mark class="bg-yellow-200 text-black px-1 rounded">$1</mark>')},_=()=>{q.post(route("logout"))},p=()=>{k.value=!k.value},M=()=>{k.value=!1},B=j=>{a.value&&!a.value.contains(j.target)&&M();const w=document.querySelector(".search-container");w&&!w.contains(j.target)&&(v.value=!1)};return I(()=>{document.addEventListener("click",B)}),ee(()=>{document.removeEventListener("click",B)}),(j,w)=>{var D,y,S,o;return t(),s("div",Me,[e("div",null,[e("button",je,[e("span",null,b((D=i.activeChannel)==null?void 0:D.name),1),m(c(R),{class:"h-5 w-5 ml-1"})])]),e("div",Le,[m(Ce),m(c(de),{class:"h-6 w-6 text-gray-500 dark:text-gray-400"}),e("div",Se,[m(c(he),{class:"h-5 w-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),P(e("input",{"onUpdate:modelValue":w[0]||(w[0]=L=>r.value=L),onInput:x,onFocus:w[1]||(w[1]=L=>v.value=!0),type:"text",placeholder:"メッセージを検索する",class:"bg-gray-100 dark:bg-gray-700 rounded-md w-80 pl-10 pr-8 py-1.5 focus:ring-blue-500 focus:border-blue-500 border-transparent text-gray-900 dark:text-gray-100"},null,544),[[N,r.value]]),r.value?(t(),s("button",{key:0,onClick:T,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",title:"検索をクリア"},w[2]||(w[2]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):C("",!0),v.value&&(h.value.length>0||$.value||n.value)?(t(),s("div",Be,[$.value?(t(),s("div",De,w[3]||(w[3]=[e("div",{class:"flex items-center justify-center"},[e("svg",{class:"animate-spin h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),Z(" 検索中... ")],-1)]))):n.value?(t(),s("div",Ee,b(n.value),1)):h.value.length>0?(t(),s("div",Ae,[(t(!0),s(Q,null,W(h.value,L=>(t(),s("div",{key:L.id,onClick:vs=>U(L),class:"px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-100 dark:border-gray-700 last:border-b-0"},[e("div",Ue,[e("div",Ve,[e("div",Oe,[e("span",Fe,b(L.user.name.charAt(0).toUpperCase()),1)])]),e("div",Ze,[e("div",ze,[e("span",He,b(L.user.name),1),e("span",Re,"#"+b(L.channel.name),1),e("span",Ke,b(L.date)+" "+b(L.time),1)]),e("div",Ie,[e("span",{innerHTML:V(L.content,r.value)},null,8,Pe)])])])],8,Te))),128))])):(t(),s("div",Ne,' "'+b(r.value)+'" に一致するメッセージが見つかりませんでした ',1))])):C("",!0)]),e("div",{ref_key:"userMenuRef",ref:a,class:"relative"},[e("button",{onClick:p,class:"flex items-center space-x-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100 focus:outline-none"},[m(c(re),{class:"h-8 w-8"}),e("span",Qe,b((y=c(g))==null?void 0:y.name),1),m(c(R),{class:"h-4 w-4"})]),k.value?(t(),s("div",We,[e("a",{href:j.route("profile.show"),class:"flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-700"},[e("img",{src:(S=c(g))==null?void 0:S.profile_photo_url,alt:(o=c(g))==null?void 0:o.name,class:"w-8 h-8 rounded-full object-cover mr-2 border border-gray-300 dark:border-gray-600"},null,8,Xe),w[4]||(w[4]=e("span",null,"プロフィール",-1))],8,qe),e("button",{onClick:_,class:"block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}," ログアウト ")])):C("",!0)],512)])])}}},Je={class:"p-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700"},Ye={class:"border border-gray-200 dark:border-gray-600 rounded-lg p-2 flex flex-col"},et={class:"relative"},tt=["disabled"],st={key:0,class:"mt-2"},at=["src"],rt={key:1,class:"mt-2"},ot={class:"text-xs text-gray-500"},nt={key:3,class:"emoji-picker-popover absolute left-0 bottom-12 z-50 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded shadow-lg p-2 w-80 max-h-60 overflow-y-auto flex flex-wrap gap-1"},lt=["onClick"],it={class:"flex items-center justify-between mt-2"},dt={class:"flex items-center space-x-2"},ct={class:"cursor-pointer text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},ut={class:"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},ht={class:"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},gt={class:"flex items-center space-x-2"},vt={class:"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},mt=["disabled"],pt={__name:"MessageInput",props:{activeChannel:Object},emits:["messageSent"],setup(i,{emit:u}){const g=i,k=u,a=f(""),r=f(!1),h=f(!1),$=["😀","😃","😄","😁","😆","😅","😂","🤣","😊","😇","🙂","🙃","😉","😌","😍","🥰","😘","😗","😙","😚","😋","😜","😝","😛","🤑","🤗","🤩","🤔","🤨","😐","😑","😶","🙄","😏","😣","😥","😮","🤐","😯","😪","😫","🥱","😴","😌","😛","😜","😝","🤤","😒","😓","😔","😕","🙃","🤑","😲","☹️","🙁","😖","😞","😟","😤","😢","😭","😦","😧","😨","😩","🤯","😬","😰","😱","🥵","🥶","😳","🤪","😵","😡","😠","🤬","😷","🤒","🤕","🤢","🤮","🥴","😇","🥳","🥺","🤠","😎","🤓","🧐","😕","🤑","🤡","🤥","🤫","🤭","🫢","🫣","🫡","🤗","🤔","🤭","🤫","🤥","🫠","🫨","🫤","🫦","👍","👎","👏","🙌","🙏","💪","👀","👋","🤙","💯","🔥","✨","🎉","🎊","❤️","🧡","💛","💚","💙","💜","🖤","🤍","🤎","💔","💕","💞","💓","💗","💖","💘"],v=f(null),n=f(null),l=_=>{const p=_.target.files[0];if(v.value=p||null,p&&p.type.startsWith("image/")){const M=new FileReader;M.onload=B=>{n.value=B.target.result},M.readAsDataURL(p)}else n.value=null},d=()=>{v.value=null,n.value=null;const _=document.getElementById("message-file-input");_&&(_.value="")},x=async()=>{var _;if(!(!a.value.trim()&&!v||!g.activeChannel)){r.value=!0;try{const p=new FormData;p.append("content",a.value.trim()),p.append("channel_id",g.activeChannel.id),v.value&&p.append("file",v.value);const M=(_=document.head.querySelector('meta[name="csrf-token"]'))==null?void 0:_.content,B={"Content-Type":"multipart/form-data"};M&&(B["X-CSRF-TOKEN"]=M);const E=await A.post("/messages",p,{headers:B});k("messageSent",E.data),a.value="",d()}catch(p){console.error("Message sending failed:",p)}finally{r.value=!1}}},T=_=>{_.key==="Enter"&&!_.shiftKey&&(_.preventDefault(),x())},U=_=>{const p=document.activeElement;if(p&&p.selectionStart!==void 0){const M=p.selectionStart,B=p.selectionEnd;a.value=a.value.substring(0,M)+_+a.value.substring(B),setTimeout(()=>{p.selectionStart=p.selectionEnd=M+_.length,p.focus()},0)}else a.value+=_;h.value=!1},V=_=>{h.value&&!_.target.closest(".emoji-picker-popover")&&!_.target.closest(".emoji-picker-toggle")&&(h.value=!1)};return typeof window<"u"&&window.addEventListener("click",V),(_,p)=>(t(),s("div",Je,[e("div",Ye,[e("div",et,[P(e("textarea",{"onUpdate:modelValue":p[0]||(p[0]=M=>a.value=M),onKeypress:T,class:"w-full border-none focus:ring-0 resize-none bg-transparent text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400",placeholder:"メモを書く",rows:"1",disabled:r.value},null,40,tt),[[N,a.value]]),n.value?(t(),s("div",st,[e("img",{src:n.value,alt:"preview",class:"max-h-32 rounded border"},null,8,at)])):v.value&&v.value.name?(t(),s("div",rt,[e("span",ot,b(v.value.name),1)])):C("",!0),v.value?(t(),s("button",{key:2,onClick:d,class:"text-xs text-red-500 ml-2"},"ファイルを削除")):C("",!0),h.value?(t(),s("div",nt,[(t(),s(Q,null,W($,M=>e("button",{key:M,class:"text-2xl p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",onClick:X(B=>U(M),["stop"]),type:"button"},b(M),9,lt)),64))])):C("",!0)]),e("div",it,[e("div",dt,[e("label",ct,[m(c(pe),{class:"h-6 w-6"}),e("input",{id:"message-file-input",type:"file",class:"hidden",accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx",onChange:l},null,32)]),e("button",ut,[m(c(ye),{class:"h-6 w-6"})]),e("button",ht,[m(c(ge),{class:"h-6 w-6"})])]),e("div",gt,[e("button",{class:"emoji-picker-toggle text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300",onClick:p[1]||(p[1]=X(M=>h.value=!h.value,["stop"])),title:"絵文字を挿入",type:"button"},[m(c(ue),{class:"h-6 w-6"})]),e("button",vt,[m(c(ie),{class:"h-6 w-6"})]),e("button",{onClick:x,disabled:!a.value.trim()&&!v.value||r.value,class:"bg-gray-800 text-white rounded p-1 hover:bg-gray-700 disabled:bg-gray-400 disabled:cursor-not-allowed",type:"button"},[m(c(ve),{class:"h-5 w-5"})],8,mt)])])])]))}},ft={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},yt={class:"bg-white rounded-lg p-6 w-full max-w-md mx-4"},xt={class:"flex items-center justify-between mb-4"},kt={class:"mb-4"},wt=["disabled"],_t={key:0,class:"mt-2 text-red-600 text-sm"},bt={class:"flex justify-end space-x-3"},$t=["disabled"],Ct=["disabled"],Mt={__name:"MessageEditModal",props:{show:Boolean,message:Object},emits:["close","messageUpdated"],setup(i,{emit:u}){const g=i,k=u,a=f(""),r=f(!1),h=f("");K(()=>g.message,l=>{l&&(a.value=l.content,h.value="")},{immediate:!0});const $=async()=>{var l,d;if(!(!a.value.trim()||!g.message)){r.value=!0,h.value="";try{const x=await A.put(`/messages/${g.message.id}`,{content:a.value.trim()});k("messageUpdated",x.data),k("close")}catch(x){console.error("Message update failed:",x),(d=(l=x.response)==null?void 0:l.data)!=null&&d.message?h.value=x.response.data.message:h.value="メッセージの更新に失敗しました"}finally{r.value=!1}}},v=()=>{var l;a.value=((l=g.message)==null?void 0:l.content)||"",h.value="",k("close")},n=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),$())};return(l,d)=>i.show?(t(),s("div",ft,[e("div",yt,[e("div",xt,[d[1]||(d[1]=e("h3",{class:"text-lg font-semibold"},"メッセージを編集",-1)),e("button",{onClick:v,class:"text-gray-500 hover:text-gray-700"},[m(c(se),{class:"h-6 w-6"})])]),e("div",kt,[P(e("textarea",{"onUpdate:modelValue":d[0]||(d[0]=x=>a.value=x),onKeypress:n,class:"w-full border border-gray-300 rounded-lg p-3 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"メッセージを入力してください",rows:"4",disabled:r.value},null,40,wt),[[N,a.value]]),h.value?(t(),s("div",_t,b(h.value),1)):C("",!0)]),e("div",bt,[e("button",{onClick:v,class:"px-4 py-2 text-gray-600 hover:text-gray-800",disabled:r.value}," キャンセル ",8,$t),e("button",{onClick:$,disabled:!a.value.trim()||r.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center space-x-2"},[m(c(F),{class:"h-4 w-4"}),e("span",null,b(r.value?"更新中...":"更新"),1)],8,Ct)])])])):C("",!0)}},jt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Lt={class:"bg-white rounded-lg p-6 w-full max-w-md mx-4"},St={class:"flex items-center justify-between mb-4"},Bt={class:"mb-4 text-gray-700"},Dt={class:"mt-2 p-2 bg-gray-100 rounded text-gray-800"},Et={key:0,class:"mt-2 text-red-600 text-sm"},At={class:"flex justify-end space-x-3"},Tt=["disabled"],Ut=["disabled"],Vt={__name:"MessageDeleteModal",props:{show:Boolean,message:Object},emits:["close","messageDeleted"],setup(i,{emit:u}){const g=i,k=u,a=f(!1),r=f(""),h=async()=>{var v,n;if(g.message){a.value=!0,r.value="";try{await A.delete(`/messages/${g.message.id}`),k("messageDeleted",g.message.id),k("close")}catch(l){r.value=((n=(v=l.response)==null?void 0:v.data)==null?void 0:n.message)||"削除に失敗しました"}finally{a.value=!1}}},$=()=>{r.value="",k("close")};return(v,n)=>{var l;return i.show?(t(),s("div",jt,[e("div",Lt,[e("div",St,[n[0]||(n[0]=e("h3",{class:"text-lg font-semibold"},"メッセージを削除",-1)),e("button",{onClick:$,class:"text-gray-500 hover:text-gray-700"},[m(c(se),{class:"h-6 w-6"})])]),e("div",Bt,[n[1]||(n[1]=Z(" 本当にこのメッセージを削除しますか？ ")),e("div",Dt,b((l=i.message)==null?void 0:l.content),1),r.value?(t(),s("div",Et,b(r.value),1)):C("",!0)]),e("div",At,[e("button",{onClick:$,class:"px-4 py-2 text-gray-600 hover:text-gray-800",disabled:a.value}," キャンセル ",8,Tt),e("button",{onClick:h,disabled:a.value,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center space-x-2"},[m(c(fe),{class:"h-4 w-4"}),e("span",null,b(a.value?"削除中...":"削除"),1)],8,Ut)])])])):C("",!0)}}},Ot={class:"flex-1 flex flex-col bg-white dark:bg-gray-900"},Ft={class:"flex-1 p-6 overflow-y-auto"},Zt={class:"w-10 h-10 rounded bg-purple-400 mr-4 shrink-0"},zt=["src"],Ht={class:"flex-1"},Rt={class:"flex items-center justify-between"},Kt={class:"font-bold text-gray-900 dark:text-gray-100"},It={class:"text-xs text-gray-500 dark:text-gray-400 font-normal ml-2"},Pt={class:"flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity"},Nt=["onClick"],Qt=["onClick"],Wt={class:"mt-1"},qt={key:0},Xt={key:0,class:"mt-2"},Gt=["src","alt","onClick"],Jt=["src","onClick"],Yt=["src","onClick"],es=["src","onClick"],ts=["src","onClick"],ss={key:5},as=["href","download"],rs={class:"text-xs text-gray-400 ml-2"},os={key:0},ns=["src","alt"],ls=["src"],is=["src"],ds=["src"],cs=["src"],us={__name:"MainContent",props:{messages:{type:Array,default:()=>[]},activeChannel:Object},emits:["messageSent","messageUpdated","messageDeleted"],setup(i,{emit:u}){var D;const k=(D=te().props.auth)==null?void 0:D.user,a=i,r=u,h=f([...a.messages||[]]),$=f(!1),v=f(null),n=f(!1),l=f(null),d=f(null),x=f(!1);K(()=>a.messages,y=>{h.value=[...y||[]]},{deep:!0});const T=y=>{h.value.unshift(y),r("messageSent",y)},U=y=>{const S=h.value.findIndex(o=>o.id===y.id);S!==-1&&(h.value[S]=y),r("messageUpdated",y)},V=y=>{const S=h.value.findIndex(o=>o.id===y);S!==-1&&h.value.splice(S,1),r("messageDeleted",y)},_=y=>{v.value=y,$.value=!0},p=()=>{$.value=!1,v.value=null},M=y=>{l.value=y,n.value=!0},B=()=>{n.value=!1,l.value=null},E=y=>{d.value=y,x.value=!0},j=()=>{x.value=!1,d.value=null},w=y=>k&&y.user.id===k.id;return(y,S)=>(t(),s("div",Ot,[m(Ge,{"active-channel":i.activeChannel},null,8,["active-channel"]),e("div",Ft,[(t(!0),s(Q,null,W(h.value,o=>(t(),s("div",{key:o.id,class:"flex items-start mb-4 group hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg p-2 -m-2"},[e("div",Zt,[e("img",{src:o.user.avatar,alt:"avatar",class:"w-8 h-8 rounded-full"},null,8,zt)]),e("div",Ht,[e("div",Rt,[e("p",Kt,[Z(b(o.user.name)+" ",1),e("span",It,b(o.time),1)]),e("div",Pt,[w(o)?(t(),s("button",{key:0,onClick:L=>_(o),class:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 p-1 rounded",title:"メッセージを編集"},[m(c(me),{class:"h-4 w-4"})],8,Nt)):C("",!0),w(o)?(t(),s("button",{key:1,onClick:L=>M(o),class:"text-red-500 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 p-1 rounded",title:"メッセージを削除"},S[0]||(S[0]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Qt)):C("",!0)])]),e("div",Wt,[o.content?(t(),s("span",qt,b(o.content),1)):C("",!0)]),o.file_path?(t(),s("div",Xt,[o.file_mime&&o.file_mime.startsWith("image/")?(t(),s("img",{key:0,src:`/storage/${o.file_path}`,alt:o.file_name,class:"max-h-48 rounded border cursor-pointer hover:opacity-80 transition",onClick:L=>E({type:"image",src:`/storage/${o.file_path}`,name:o.file_name,mime:o.file_mime})},null,8,Gt)):o.file_mime&&o.file_mime.startsWith("video/")?(t(),s("video",{key:1,src:`/storage/${o.file_path}`,controls:"",class:"max-h-48 rounded border cursor-pointer hover:opacity-80 transition",onClick:L=>E({type:"video",src:`/storage/${o.file_path}`,name:o.file_name,mime:o.file_mime})},null,8,Jt)):o.file_mime&&o.file_mime.startsWith("audio/")?(t(),s("audio",{key:2,src:`/storage/${o.file_path}`,controls:"",class:"w-full cursor-pointer hover:opacity-80 transition",onClick:L=>E({type:"audio",src:`/storage/${o.file_path}`,name:o.file_name,mime:o.file_mime})},null,8,Yt)):o.file_mime==="application/pdf"?(t(),s("iframe",{key:3,src:`/storage/${o.file_path}`,class:"w-full max-h-96 border rounded cursor-pointer hover:opacity-80 transition",onClick:L=>E({type:"pdf",src:`/storage/${o.file_path}`,name:o.file_name,mime:o.file_mime})},null,8,es)):["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(o.file_mime)?(t(),s("iframe",{key:4,src:`https://docs.google.com/gview?url=${y.location.origin}/storage/${o.file_path}&embedded=true`,class:"w-full max-h-96 border rounded cursor-pointer hover:opacity-80 transition",onClick:L=>E({type:"doc",src:`https://docs.google.com/gview?url=${y.location.origin}/storage/${o.file_path}&embedded=true`,name:o.file_name,mime:o.file_mime})},null,8,ts)):(t(),s("div",ss,[e("a",{href:`/storage/${o.file_path}`,download:o.file_name,class:"text-blue-600 underline",target:"_blank"},b(o.file_name),9,as),e("span",rs,"("+b((o.file_size/1024).toFixed(1))+" KB)",1)]))])):C("",!0)])]))),128))]),m(pt,{"active-channel":i.activeChannel,onMessageSent:T},null,8,["active-channel"]),m(Mt,{show:$.value,message:v.value,onClose:p,onMessageUpdated:U},null,8,["show","message"]),m(Vt,{show:n.value,message:l.value,onClose:B,onMessageDeleted:V},null,8,["show","message"]),m(le,{show:x.value,"max-width":"4xl",onClose:j},{title:H(()=>{var o;return[Z(b((o=d.value)==null?void 0:o.name),1)]}),content:H(()=>[d.value?(t(),s("div",os,[d.value.type==="image"?(t(),s("img",{key:0,src:d.value.src,alt:d.value.name,class:"max-h-[70vh] mx-auto rounded border"},null,8,ns)):d.value.type==="video"?(t(),s("video",{key:1,src:d.value.src,controls:"",class:"max-h-[70vh] mx-auto rounded border"},null,8,ls)):d.value.type==="audio"?(t(),s("audio",{key:2,src:d.value.src,controls:"",class:"w-full mx-auto"},null,8,is)):d.value.type==="pdf"?(t(),s("iframe",{key:3,src:d.value.src,class:"w-full min-h-[60vh] border rounded"},null,8,ds)):d.value.type==="doc"?(t(),s("iframe",{key:4,src:d.value.src,class:"w-full min-h-[60vh] border rounded"},null,8,cs)):C("",!0)])):C("",!0)]),footer:H(()=>[e("button",{onClick:j,class:"px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-600"},"閉じる")]),_:1},8,["show"])]))}},hs={class:"flex h-screen bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200"},gs={class:"flex-1 flex flex-col"},ys={__name:"AppLayout",props:{title:String,channels:Array,"direct-messages":Array,messages:Array,activeChannel:Object,manualOffline:Boolean},emits:["selectChannel","newChannelAdded","messageSent","messageUpdated","messageDeleted","toggleManualOffline","channelDeleted","channelLeft"],setup(i,{emit:u}){const g=u;return(k,a)=>(t(),s("div",null,[m(c(ae),{title:i.title},null,8,["title"]),e("div",hs,[m(oe),m(ne,{channels:i.channels,"direct-messages":k.direct-i.messages,"manual-offline":i.manualOffline,onToggleManualOffline:a[0]||(a[0]=r=>g("toggleManualOffline",r)),onSelectChannel:a[1]||(a[1]=r=>g("selectChannel",r)),onNewChannelAdded:a[2]||(a[2]=r=>g("newChannelAdded",r)),onChannelDeleted:a[3]||(a[3]=r=>g("channelDeleted",r)),onChannelLeft:a[4]||(a[4]=r=>g("channelLeft",r))},null,8,["channels","direct-messages","manual-offline"]),e("div",gs,[G(k.$slots,"notifications"),G(k.$slots,"default"),m(us,{messages:i.messages,"active-channel":i.activeChannel,onMessageSent:a[5]||(a[5]=r=>g("messageSent",r)),onMessageUpdated:a[6]||(a[6]=r=>g("messageUpdated",r)),onMessageDeleted:a[7]||(a[7]=r=>g("messageDeleted",r))},null,8,["messages","active-channel"])])])]))}};export{ys as _};
