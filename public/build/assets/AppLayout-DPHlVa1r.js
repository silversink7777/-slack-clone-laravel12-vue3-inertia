import{e as a,o as s,a as e,d as h,B as de,q as re,z as P,A as ye,f as _,c as Z,b,u as p,t as f,n as ae,C as ke,g as K,k as X,v as Y,F as ee,h as te,m as we,Q as he,j as ge,w as le,y as be,p as $e,r as me}from"./app-Dat6Ui5J.js";import{_ as Ce}from"./WorkspaceSidebar-V0T4plSC.js";import{r as ie,a as Me,_ as De}from"./ChannelListSidebar-BF5V8X26.js";import{_ as je}from"./DialogModal-D5YApQ5-.js";function Se(o,u){return s(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"})])}function Le(o,u){return s(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M16.5 12a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0Zm0 0c0 1.657 1.007 3 2.25 3S21 13.657 21 12a9 9 0 1 0-2.636 6.364M16.5 12V8.25"})])}function oe(o,u){return s(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m4.5 12.75 6 6 9-13.5"})])}function Ee(o,u){return s(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})])}function Be(o,u){return s(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 17.25v1.007a3 3 0 0 1-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0 1 15 18.257V17.25m6-12V15a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 15V5.25m18 0A2.25 2.25 0 0 0 18.75 3H5.25A2.25 2.25 0 0 0 3 5.25m18 0V12a2.25 2.25 0 0 1-2.25 2.25H5.25A2.25 2.25 0 0 1 3 12V5.25"})])}function Ae(o,u){return s(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15.182 15.182a4.5 4.5 0 0 1-6.364 0M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0ZM9.75 9.75c0 .414-.168.75-.375.75S9 10.164 9 9.75 9.168 9 9.375 9s.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Zm5.625 0c0 .414-.168.75-.375.75s-.375-.336-.375-.75.168-.75.375-.75.375.336.375.75Zm-.375 0h.008v.015h-.008V9.75Z"})])}function Te(o,u){return s(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"})])}function Pe(o,u){return s(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 18.75a6 6 0 0 0 6-6v-1.5m-6 7.5a6 6 0 0 1-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 0 1-3-3V4.5a3 3 0 1 1 6 0v8.25a3 3 0 0 1-3 3Z"})])}function pe(o,u){return s(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z"})])}function Ue(o,u){return s(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})])}function fe(o,u){return s(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L6.832 19.82a4.5 4.5 0 0 1-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 0 1 1.13-1.897L16.863 4.487Zm0 0L19.5 7.125"})])}function Ve(o,u){return s(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 4.5v15m7.5-7.5h-15"})])}function xe(o,u){return s(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"})])}function Oe(o,u){return s(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m14.74 9-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 0 1-2.244 2.077H8.084a2.25 2.25 0 0 1-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 0 0-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 0 1 3.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 0 0-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 0 0-7.5 0"})])}function ze(o,u){return s(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"m15.75 10.5 4.72-4.72a.75.75 0 0 1 1.28.53v11.38a.75.75 0 0 1-1.28.53l-4.72-4.72M4.5 18.75h9a2.25 2.25 0 0 0 2.25-2.25v-9a2.25 2.25 0 0 0-2.25-2.25h-9A2.25 2.25 0 0 0 2.25 7.5v9a2.25 2.25 0 0 0 2.25 2.25Z"})])}function _e(o,u){return s(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18 18 6M6 6l12 12"})])}function Fe(){const o=h("system"),u=h(!1),m=h(!1),y=()=>window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",d=i=>{(i==="system"?y():i)==="dark"?(document.documentElement.classList.add("dark"),u.value=!0):(document.documentElement.classList.remove("dark"),u.value=!1)},c=async()=>{try{const i=await P.get("/api/auth/check");return console.log("Auth status:",i.data),i.data.authenticated}catch(i){return console.error("Failed to check auth status:",i),!1}},r=async()=>{var i,n;try{m.value=!0,console.log("Loading theme...");const g=await c();console.log("Is authenticated:",g);const x=await P.get("/theme");console.log("Theme loaded successfully:",x.data),o.value=x.data.theme,d(o.value)}catch(g){console.error("Failed to load theme:",g),console.error("Error response:",(i=g.response)==null?void 0:i.data),console.error("Error status:",(n=g.response)==null?void 0:n.status),o.value="system",d("system")}finally{m.value=!1}},l=async i=>{var n,g;try{m.value=!0,console.log("Updating theme to:",i);const x=await c();console.log("Is authenticated:",x),await P.post("/theme",{theme:i}),console.log("Theme updated successfully"),o.value=i,d(i)}catch(x){throw console.error("Failed to update theme:",x),console.error("Error response:",(n=x.response)==null?void 0:n.data),console.error("Error status:",(g=x.response)==null?void 0:g.status),x}finally{m.value=!1}},k=()=>{window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{o.value==="system"&&d("system")})};return de(o,i=>{d(i)}),re(()=>{r(),k()}),{theme:o,isDark:u,isLoading:m,updateTheme:l,loadTheme:r}}const Ie={class:"relative"},Re=["disabled"],Ze={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},He={key:0,class:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50"},Ne={class:"py-1"},Ke={__name:"ThemeToggle",setup(o){const{theme:u,isDark:m,isLoading:y,updateTheme:d}=Fe(),c=h(!1),r=i=>{switch(i){case"light":return"ライト";case"dark":return"ダーク";case"system":return"システム";default:return"システム"}},l=async i=>{try{await d(i),c.value=!1}catch(n){console.error("Failed to update theme:",n),alert("テーマの更新に失敗しました")}},k=i=>{i.target.closest(".relative")||(c.value=!1)};return re(()=>{document.addEventListener("click",k)}),ye(()=>{document.removeEventListener("click",k)}),(i,n)=>(s(),a("div",Ie,[e("button",{onClick:n[0]||(n[0]=g=>c.value=!c.value),class:"flex items-center space-x-2 px-3 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors",disabled:p(y)},[p(m)?(s(),Z(p(xe),{key:0,class:"h-5 w-5 text-yellow-500"})):(s(),Z(p(pe),{key:1,class:"h-5 w-5 text-gray-600 dark:text-gray-400"})),e("span",Ze,f(r(p(u))),1),b(p(ie),{class:"h-4 w-4 text-gray-500 dark:text-gray-400"})],8,Re),c.value?(s(),a("div",He,[e("div",Ne,[e("button",{onClick:n[1]||(n[1]=g=>l("light")),class:ae(["w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",{"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":p(u)==="light"}])},[b(p(xe),{class:"h-4 w-4"}),n[4]||(n[4]=e("span",null,"ライト",-1)),p(u)==="light"?(s(),Z(p(oe),{key:0,class:"h-4 w-4 ml-auto"})):_("",!0)],2),e("button",{onClick:n[2]||(n[2]=g=>l("dark")),class:ae(["w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",{"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":p(u)==="dark"}])},[b(p(pe),{class:"h-4 w-4"}),n[5]||(n[5]=e("span",null,"ダーク",-1)),p(u)==="dark"?(s(),Z(p(oe),{key:0,class:"h-4 w-4 ml-auto"})):_("",!0)],2),e("button",{onClick:n[3]||(n[3]=g=>l("system")),class:ae(["w-full flex items-center space-x-3 px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",{"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-400":p(u)==="system"}])},[b(p(Be),{class:"h-4 w-4"}),n[6]||(n[6]=e("span",null,"システム",-1)),p(u)==="system"?(s(),Z(p(oe),{key:0,class:"h-4 w-4 ml-auto"})):_("",!0)],2)])])):_("",!0)]))}},We={class:"h-16 border-b border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex items-center justify-between px-6"},qe={class:"flex items-center font-bold text-gray-900 dark:text-gray-100"},Qe={key:0},Xe={key:1},Je={key:2},Ge={class:"flex items-center space-x-4"},Ye={class:"relative search-container"},et={key:1,class:"absolute top-full left-0 right-0 mt-1 bg-white dark:bg-gray-800 rounded-md shadow-lg border border-gray-200 dark:border-gray-700 max-h-96 overflow-y-auto z-50"},tt={key:0,class:"p-4 text-center text-gray-500"},st={key:1,class:"p-4 text-center text-red-500"},at={key:2,class:"py-2"},ot=["onClick"],rt={class:"flex items-start space-x-3"},nt={class:"flex-shrink-0"},lt={class:"w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center"},it={class:"text-sm font-medium text-gray-600"},dt={class:"flex-1 min-w-0"},ct={class:"flex items-center space-x-2"},ut={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},vt={class:"text-xs text-gray-500 dark:text-gray-400"},ht={class:"text-xs text-gray-400 dark:text-gray-500"},gt={class:"mt-1 text-sm text-gray-700 dark:text-gray-300"},mt=["innerHTML"],pt={key:3,class:"p-4 text-center text-gray-500"},ft={class:"text-sm font-medium"},xt={key:0,class:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-50 border border-gray-200 dark:border-gray-700"},yt=["href"],kt=["src","alt"],_t={key:0,class:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-30"},wt={class:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 w-full max-w-md"},bt={class:"mb-2"},$t={class:"mb-2"},Ct={class:"mb-2"},Mt={class:"flex items-center space-x-2 mt-4"},Dt=["disabled"],jt={key:0,class:"mt-2 text-sm text-gray-500"},St={key:1,class:"mt-2 text-sm text-red-500"},Lt={key:2,class:"mt-2 text-green-600"},Et=["href"],Bt={__name:"MainHeader",props:{activeChannel:Object,activeDirectMessage:Object},setup(o){var B;const u=o,y=(B=ke().props.auth)==null?void 0:B.user,d=h(!1),c=h(null),r=h(""),l=h([]),k=h(!1),i=h(!1),n=h("");function g(S,v){let z;return function(...H){const N=()=>{z=null,S.apply(this,H)};clearTimeout(z),z=setTimeout(N,v)}}const x=g(async S=>{if(!S.trim()){l.value=[],i.value=!1;return}k.value=!0,n.value="";try{const v=await P.get("/messages/search",{params:{q:S.trim()}});l.value=v.data.messages,i.value=!0}catch(v){console.error("Search error:",v),n.value="検索中にエラーが発生しました",l.value=[]}finally{k.value=!1}},300),C=()=>{x(r.value)},M=()=>{r.value="",l.value=[],i.value=!1,n.value=""},F=S=>{he.visit(`/dashboard?channel=${S.channel.id}&message=${S.id}`),M()},D=(S,v)=>{if(!v)return S;const z=new RegExp(`(${v})`,"gi");return S.replace(z,'<mark class="bg-yellow-200 text-black px-1 rounded">$1</mark>')},$=()=>{he.post(route("logout"))},E=()=>{d.value=!d.value},V=()=>{d.value=!1},I=S=>{c.value&&!c.value.contains(S.target)&&V();const v=document.querySelector(".search-container");v&&!v.contains(S.target)&&(i.value=!1)},W=h(!1),J=h("csv"),q=h(""),G=h(""),A=h(!1),T=h(""),O=h(""),R=h(0),w=()=>{W.value=!0,T.value="",O.value="",R.value=0},j=()=>{W.value=!1,T.value="",O.value="",R.value=0},t=async()=>{var S,v,z,H,N,L,ne,ce;A.value=!0,T.value="",O.value="",R.value=0;try{let U="",se={format:J.value,start_date:q.value||void 0,end_date:G.value||void 0,include_files:!1};if(u.activeChannel)U="/api/messages/export/channel",se.channel_id=u.activeChannel.id;else if(u.activeDirectMessage)U="/api/messages/export/direct",se.partner_id=u.activeDirectMessage.id;else{T.value="チャンネルまたはDMを選択してください",A.value=!1;return}console.log("Exporting messages:",{url:U,payload:se});const ue=(S=document.head.querySelector('meta[name="csrf-token"]'))==null?void 0:S.content,ve={"Content-Type":"application/json",Accept:"application/json"};ue&&(ve["X-CSRF-TOKEN"]=ue);const Q=await P.post(U,se,{headers:ve});console.log("Export response:",Q.data),Q.data&&Q.data.success?(O.value=Q.data.download_url,R.value=Q.data.message_count):T.value=((v=Q.data)==null?void 0:v.error)||"エクスポートに失敗しました"}catch(U){console.error("Export error:",U),console.error("Export error response:",U.response),(H=(z=U.response)==null?void 0:z.data)!=null&&H.error?T.value=U.response.data.error:((N=U.response)==null?void 0:N.status)===403?T.value="アクセス権限がありません":((L=U.response)==null?void 0:L.status)===404?T.value="チャンネルまたはDMが見つかりません":((ne=U.response)==null?void 0:ne.status)===422?T.value="入力データが正しくありません":((ce=U.response)==null?void 0:ce.status)>=500?T.value="サーバーエラーが発生しました":T.value="エクスポートに失敗しました: "+(U.message||"不明なエラー")}finally{A.value=!1}};return re(()=>{document.addEventListener("click",I)}),ye(()=>{document.removeEventListener("click",I)}),(S,v)=>{var z,H,N;return s(),a("div",We,[e("div",null,[e("button",qe,[o.activeChannel?(s(),a("span",Qe,f(o.activeChannel.name),1)):o.activeDirectMessage?(s(),a("span",Xe,f(o.activeDirectMessage.name),1)):(s(),a("span",Je,"チャンネルまたはダイレクトメッセージを選択してください")),b(p(ie),{class:"h-5 w-5 ml-1"})])]),e("div",Ge,[e("button",{onClick:w,class:"flex items-center px-2 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-700 focus:outline-none",title:"メッセージをエクスポート"},[b(p(Se),{class:"h-5 w-5 mr-1"}),v[5]||(v[5]=K(" エクスポート "))]),b(Ke),b(p(Ee),{class:"h-6 w-6 text-gray-500 dark:text-gray-400"}),e("div",Ye,[b(p(Te),{class:"h-5 w-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),X(e("input",{"onUpdate:modelValue":v[0]||(v[0]=L=>r.value=L),onInput:C,onFocus:v[1]||(v[1]=L=>i.value=!0),type:"text",placeholder:"メッセージを検索する",class:"bg-gray-100 dark:bg-gray-700 rounded-md w-80 pl-10 pr-8 py-1.5 focus:ring-blue-500 focus:border-blue-500 border-transparent text-gray-900 dark:text-gray-100"},null,544),[[Y,r.value]]),r.value?(s(),a("button",{key:0,onClick:M,class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",title:"検索をクリア"},v[6]||(v[6]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))):_("",!0),i.value&&(l.value.length>0||k.value||n.value)?(s(),a("div",et,[k.value?(s(),a("div",tt,v[7]||(v[7]=[e("div",{class:"flex items-center justify-center"},[e("svg",{class:"animate-spin h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]),K(" 検索中... ")],-1)]))):n.value?(s(),a("div",st,f(n.value),1)):l.value.length>0?(s(),a("div",at,[(s(!0),a(ee,null,te(l.value,L=>(s(),a("div",{key:L.id,onClick:ne=>F(L),class:"px-4 py-3 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-100 dark:border-gray-700 last:border-b-0"},[e("div",rt,[e("div",nt,[e("div",lt,[e("span",it,f(L.user.name.charAt(0).toUpperCase()),1)])]),e("div",dt,[e("div",ct,[e("span",ut,f(L.user.name),1),e("span",vt,"#"+f(L.channel.name),1),e("span",ht,f(L.date)+" "+f(L.time),1)]),e("div",gt,[e("span",{innerHTML:D(L.content,r.value)},null,8,mt)])])])],8,ot))),128))])):(s(),a("div",pt,' "'+f(r.value)+'" に一致するメッセージが見つかりませんでした ',1))])):_("",!0)]),e("div",{ref_key:"userMenuRef",ref:c,class:"relative"},[e("button",{onClick:E,class:"flex items-center space-x-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100 focus:outline-none"},[b(p(Me),{class:"h-8 w-8"}),e("span",ft,f((z=p(y))==null?void 0:z.name),1),b(p(ie),{class:"h-4 w-4"})]),d.value?(s(),a("div",xt,[e("a",{href:S.route("profile.show"),class:"flex items-center px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 border-b border-gray-100 dark:border-gray-700"},[e("img",{src:(H=p(y))==null?void 0:H.profile_photo_url,alt:(N=p(y))==null?void 0:N.name,class:"w-8 h-8 rounded-full object-cover mr-2 border border-gray-300 dark:border-gray-600"},null,8,kt),v[8]||(v[8]=e("span",null,"プロフィール",-1))],8,yt),e("button",{onClick:$,class:"block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}," ログアウト ")])):_("",!0)],512)]),W.value?(s(),a("div",_t,[e("div",wt,[v[13]||(v[13]=e("h2",{class:"text-lg font-bold mb-4"},"メッセージエクスポート",-1)),e("div",bt,[v[10]||(v[10]=e("label",{class:"block text-sm font-medium mb-1"},"形式",-1)),X(e("select",{"onUpdate:modelValue":v[2]||(v[2]=L=>J.value=L),class:"w-full border rounded px-2 py-1"},v[9]||(v[9]=[e("option",{value:"csv"},"CSV",-1),e("option",{value:"json"},"JSON",-1)]),512),[[we,J.value]])]),e("div",$t,[v[11]||(v[11]=e("label",{class:"block text-sm font-medium mb-1"},"開始日（任意）",-1)),X(e("input",{type:"date","onUpdate:modelValue":v[3]||(v[3]=L=>q.value=L),class:"w-full border rounded px-2 py-1"},null,512),[[Y,q.value]])]),e("div",Ct,[v[12]||(v[12]=e("label",{class:"block text-sm font-medium mb-1"},"終了日（任意）",-1)),X(e("input",{type:"date","onUpdate:modelValue":v[4]||(v[4]=L=>G.value=L),class:"w-full border rounded px-2 py-1"},null,512),[[Y,G.value]])]),e("div",Mt,[e("button",{onClick:t,disabled:A.value,class:"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 disabled:opacity-50"},"エクスポート",8,Dt),e("button",{onClick:j,class:"bg-gray-300 text-gray-800 px-4 py-2 rounded hover:bg-gray-400"},"キャンセル")]),A.value?(s(),a("div",jt,"エクスポート中...")):_("",!0),T.value?(s(),a("div",St,f(T.value),1)):_("",!0),O.value?(s(),a("div",Lt,[e("p",null,"エクスポート成功（"+f(R.value)+"件）",1),e("a",{href:O.value,class:"underline text-blue-600",download:""},"ダウンロード",8,Et)])):_("",!0)])])):_("",!0)])}}},At={class:"p-4 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700"},Tt={class:"border border-gray-200 dark:border-gray-600 rounded-lg p-2 flex flex-col"},Pt={class:"relative"},Ut=["disabled"],Vt={key:0,class:"mt-2"},Ot=["src"],zt={key:1,class:"mt-2"},Ft={class:"text-xs text-gray-500"},It={key:3,class:"emoji-picker-popover absolute left-0 bottom-12 z-50 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded shadow-lg p-2 w-80 max-h-60 overflow-y-auto flex flex-wrap gap-1"},Rt=["onClick"],Zt={class:"flex items-center justify-between mt-2"},Ht={class:"flex items-center space-x-2"},Nt={class:"cursor-pointer text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},Kt={class:"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},Wt={class:"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},qt={class:"flex items-center space-x-2"},Qt={class:"text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300"},Xt=["disabled"],Jt={__name:"MessageInput",props:{activeChannel:Object,activeDirectMessage:Object},emits:["messageSent"],setup(o,{emit:u}){const m=o,y=u,d=h(""),c=h(!1),r=h(!1),l=["😀","😃","😄","😁","😆","😅","😂","🤣","😊","😇","🙂","🙃","😉","😌","😍","🥰","😘","😗","😙","😚","😋","😜","😝","😛","🤑","🤗","🤩","🤔","🤨","😐","😑","😶","🙄","😏","😣","😥","😮","🤐","😯","😪","😫","🥱","😴","😌","😛","😜","😝","🤤","😒","😓","😔","😕","🙃","🤑","😲","☹️","🙁","😖","😞","😟","😤","😢","😭","😦","😧","😨","😩","🤯","😬","😰","😱","🥵","🥶","😳","🤪","😵","😡","😠","🤬","😷","🤒","🤕","🤢","🤮","🥴","😇","🥳","🥺","🤠","😎","🤓","🧐","😕","🤑","🤡","🤥","🤫","🤭","🫢","🫣","🫡","🤗","🤔","🤭","🤫","🤥","🫠","🫨","🫤","🫦","👍","👎","👏","🙌","🙏","💪","👀","👋","🤙","💯","🔥","✨","🎉","🎊","❤️","🧡","💛","💚","💙","💜","🖤","🤍","🤎","💔","💕","💞","💓","💗","💖","💘"],k=h(null),i=h(null),n=D=>{const $=D.target.files[0];if(k.value=$||null,$&&$.type.startsWith("image/")){const E=new FileReader;E.onload=V=>{i.value=V.target.result},E.readAsDataURL($)}else i.value=null},g=()=>{k.value=null,i.value=null;const D=document.getElementById("message-file-input");D&&(D.value="")},x=async()=>{var D;if(!(!d.value.trim()&&!k||!m.activeChannel&&!m.activeDirectMessage)){c.value=!0;try{const $=new FormData;$.append("content",d.value.trim()),m.activeChannel&&$.append("channel_id",m.activeChannel.id),m.activeDirectMessage&&$.append("receiver_id",m.activeDirectMessage.id),k.value&&$.append("file",k.value);const E=(D=document.head.querySelector('meta[name="csrf-token"]'))==null?void 0:D.content,V={"Content-Type":"multipart/form-data"};E&&(V["X-CSRF-TOKEN"]=E);let I;m.activeDirectMessage?I=await P.post("/api/direct-messages",$,{headers:V}):I=await P.post("/messages",$,{headers:V}),y("messageSent",I.data),d.value="",g()}catch($){console.error("Message sending failed:",$)}finally{c.value=!1}}},C=D=>{D.key==="Enter"&&!D.shiftKey&&(D.preventDefault(),x())},M=D=>{const $=document.activeElement;if($&&$.selectionStart!==void 0){const E=$.selectionStart,V=$.selectionEnd;d.value=d.value.substring(0,E)+D+d.value.substring(V),setTimeout(()=>{$.selectionStart=$.selectionEnd=E+D.length,$.focus()},0)}else d.value+=D;r.value=!1},F=D=>{r.value&&!D.target.closest(".emoji-picker-popover")&&!D.target.closest(".emoji-picker-toggle")&&(r.value=!1)};return typeof window<"u"&&window.addEventListener("click",F),(D,$)=>(s(),a("div",At,[e("div",Tt,[e("div",Pt,[X(e("textarea",{"onUpdate:modelValue":$[0]||($[0]=E=>d.value=E),onKeypress:C,class:"w-full border-none focus:ring-0 resize-none bg-transparent text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400",placeholder:"メモを書く",rows:"1",disabled:c.value},null,40,Ut),[[Y,d.value]]),i.value?(s(),a("div",Vt,[e("img",{src:i.value,alt:"preview",class:"max-h-32 rounded border"},null,8,Ot)])):k.value&&k.value.name?(s(),a("div",zt,[e("span",Ft,f(k.value.name),1)])):_("",!0),k.value?(s(),a("button",{key:2,onClick:g,class:"text-xs text-red-500 ml-2"},"ファイルを削除")):_("",!0),r.value?(s(),a("div",It,[(s(),a(ee,null,te(l,E=>e("button",{key:E,class:"text-2xl p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",onClick:ge(V=>M(E),["stop"]),type:"button"},f(E),9,Rt)),64))])):_("",!0)]),e("div",Zt,[e("div",Ht,[e("label",Nt,[b(p(Ve),{class:"h-6 w-6"}),e("input",{id:"message-file-input",type:"file",class:"hidden",accept:"image/*,.pdf,.doc,.docx,.xls,.xlsx",onChange:n},null,32)]),e("button",Kt,[b(p(ze),{class:"h-6 w-6"})]),e("button",Wt,[b(p(Pe),{class:"h-6 w-6"})])]),e("div",qt,[e("button",{class:"emoji-picker-toggle text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-300",onClick:$[1]||($[1]=ge(E=>r.value=!r.value,["stop"])),title:"絵文字を挿入",type:"button"},[b(p(Ae),{class:"h-6 w-6"})]),e("button",Qt,[b(p(Le),{class:"h-6 w-6"})]),e("button",{onClick:x,disabled:!d.value.trim()&&!k.value||c.value,class:"bg-gray-800 text-white rounded p-1 hover:bg-gray-700 disabled:bg-gray-400 disabled:cursor-not-allowed",type:"button"},[b(p(Ue),{class:"h-5 w-5"})],8,Xt)])])])]))}},Gt={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Yt={class:"bg-white rounded-lg p-6 w-full max-w-md mx-4"},es={class:"flex items-center justify-between mb-4"},ts={class:"mb-4"},ss=["disabled"],as={key:0,class:"mt-2 text-red-600 text-sm"},os={class:"flex justify-end space-x-3"},rs=["disabled"],ns=["disabled"],ls={__name:"MessageEditModal",props:{show:Boolean,message:Object,activeDirectMessage:Object},emits:["close","messageUpdated"],setup(o,{emit:u}){const m=o,y=u,d=h(""),c=h(!1),r=h("");de(()=>m.message,n=>{n&&(d.value=n.content,r.value="")},{immediate:!0});const l=async()=>{var n,g;if(!(!d.value.trim()||!m.message)){c.value=!0,r.value="";try{let x;m.activeDirectMessage?x=await P.put(`/api/direct-messages/${m.message.id}`,{content:d.value.trim()}):x=await P.put(`/messages/${m.message.id}`,{content:d.value.trim()}),y("messageUpdated",x.data),y("close")}catch(x){console.error("Message update failed:",x),(g=(n=x.response)==null?void 0:n.data)!=null&&g.message?r.value=x.response.data.message:r.value="メッセージの更新に失敗しました"}finally{c.value=!1}}},k=()=>{var n;d.value=((n=m.message)==null?void 0:n.content)||"",r.value="",y("close")},i=n=>{n.key==="Enter"&&!n.shiftKey&&(n.preventDefault(),l())};return(n,g)=>o.show?(s(),a("div",Gt,[e("div",Yt,[e("div",es,[g[1]||(g[1]=e("h3",{class:"text-lg font-semibold"},"メッセージを編集",-1)),e("button",{onClick:k,class:"text-gray-500 hover:text-gray-700"},[b(p(_e),{class:"h-6 w-6"})])]),e("div",ts,[X(e("textarea",{"onUpdate:modelValue":g[0]||(g[0]=x=>d.value=x),onKeypress:i,class:"w-full border border-gray-300 rounded-lg p-3 focus:ring-blue-500 focus:border-blue-500 resize-none",placeholder:"メッセージを入力してください",rows:"4",disabled:c.value},null,40,ss),[[Y,d.value]]),r.value?(s(),a("div",as,f(r.value),1)):_("",!0)]),e("div",os,[e("button",{onClick:k,class:"px-4 py-2 text-gray-600 hover:text-gray-800",disabled:c.value}," キャンセル ",8,rs),e("button",{onClick:l,disabled:!d.value.trim()||c.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center space-x-2"},[b(p(oe),{class:"h-4 w-4"}),e("span",null,f(c.value?"更新中...":"更新"),1)],8,ns)])])])):_("",!0)}},is={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ds={class:"bg-white rounded-lg p-6 w-full max-w-md mx-4"},cs={class:"flex items-center justify-between mb-4"},us={class:"mb-4 text-gray-700"},vs={class:"mt-2 p-2 bg-gray-100 rounded text-gray-800"},hs={key:0,class:"mt-2 text-red-600 text-sm"},gs={class:"flex justify-end space-x-3"},ms=["disabled"],ps=["disabled"],fs={__name:"MessageDeleteModal",props:{show:Boolean,message:Object,activeDirectMessage:Object},emits:["close","messageDeleted"],setup(o,{emit:u}){const m=o,y=u,d=h(!1),c=h(""),r=async()=>{var k,i;if(m.message){d.value=!0,c.value="";try{m.activeDirectMessage?await P.delete(`/api/direct-messages/${m.message.id}`):await P.delete(`/messages/${m.message.id}`),y("messageDeleted",m.message.id),y("close")}catch(n){c.value=((i=(k=n.response)==null?void 0:k.data)==null?void 0:i.message)||"削除に失敗しました"}finally{d.value=!1}}},l=()=>{c.value="",y("close")};return(k,i)=>{var n;return o.show?(s(),a("div",is,[e("div",ds,[e("div",cs,[i[0]||(i[0]=e("h3",{class:"text-lg font-semibold"},"メッセージを削除",-1)),e("button",{onClick:l,class:"text-gray-500 hover:text-gray-700"},[b(p(_e),{class:"h-6 w-6"})])]),e("div",us,[i[1]||(i[1]=K(" 本当にこのメッセージを削除しますか？ ")),e("div",vs,f((n=o.message)==null?void 0:n.content),1),c.value?(s(),a("div",hs,f(c.value),1)):_("",!0)]),e("div",gs,[e("button",{onClick:l,class:"px-4 py-2 text-gray-600 hover:text-gray-800",disabled:d.value}," キャンセル ",8,ms),e("button",{onClick:r,disabled:d.value,class:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center space-x-2"},[b(p(Oe),{class:"h-4 w-4"}),e("span",null,f(d.value?"削除中...":"削除"),1)],8,ps)])])])):_("",!0)}}},xs=["title","disabled"],ys={key:0,class:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},ks={key:1,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},_s={__name:"PinMessageButton",props:{messageId:{type:[String,Number],required:!0},channelId:{type:[String,Number],required:!0},isPinned:{type:Boolean,default:!1}},emits:["pin-toggled"],setup(o,{emit:u}){const m=o,y=u,d=h(!1),c=async()=>{if(!d.value){d.value=!0;try{if(m.isPinned)await P.delete("/api/pinned-messages",{data:{message_id:m.messageId,channel_id:m.channelId}}),y("pin-toggled",!1,null);else{const r=await P.post("/api/pinned-messages",{message_id:m.messageId,channel_id:m.channelId});y("pin-toggled",!0,r.data.id)}}catch(r){console.error("Pin toggle failed:",r)}finally{d.value=!1}}};return(r,l)=>(s(),a("button",{onClick:c,class:ae(["p-1 rounded transition-colors",o.isPinned?"text-yellow-500 dark:text-yellow-400 hover:text-yellow-700 dark:hover:text-yellow-300":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"]),title:o.isPinned?"ピン留めを解除":"メッセージをピン留め",disabled:d.value},[d.value?(s(),a("svg",ys,l[0]||(l[0]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):(s(),a("svg",ks,l[1]||(l[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13"},null,-1)])))],10,xs))}},ws={class:"bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"},bs={class:"p-4"},$s={class:"flex items-center justify-between mb-3"},Cs={class:"text-sm font-medium text-gray-900 dark:text-gray-100 flex items-center"},Ms={class:"ml-2 text-xs text-gray-500 dark:text-gray-400"},Ds={key:0,class:"flex justify-center py-4"},js={key:1,class:"text-center py-4"},Ss={key:2,class:"space-y-3 max-h-96 overflow-y-auto"},Ls={class:"flex items-start space-x-3"},Es=["src","alt"],Bs={class:"flex-1 min-w-0"},As={class:"flex items-center justify-between"},Ts={class:"flex items-center space-x-2"},Ps={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Us={class:"text-xs text-gray-500 dark:text-gray-400"},Vs=["onClick"],Os={class:"text-sm text-gray-700 dark:text-gray-300 mt-1"},zs={key:0,class:"mt-2"},Fs=["src","alt"],Is={key:1,class:"flex items-center space-x-2 text-xs text-gray-500 dark:text-gray-400"},Rs={class:"text-xs text-gray-500 dark:text-gray-400 mt-2"},Zs={__name:"PinnedMessagesList",props:{channelId:{type:[String,Number],required:!0}},emits:["pin-removed"],setup(o,{expose:u,emit:m}){const y=o,d=m,c=h([]),r=h(!1),l=h(!1),k=async()=>{r.value=!0;try{const x=await P.get("/api/pinned-messages",{params:{channel_id:y.channelId}});c.value=x.data}catch(x){console.error("Failed to fetch pinned messages:",x)}finally{r.value=!1}},i=async x=>{try{await P.delete(`/api/pinned-messages/${x}`);const C=c.value.findIndex(M=>M.id===x);C!==-1&&c.value.splice(C,1),d("pin-removed",x)}catch(C){console.error("Failed to remove pin:",C)}},n=()=>{l.value=!l.value};return u({refreshPinnedMessages:()=>{k()}}),re(()=>{k()}),(x,C)=>(s(),a("div",ws,[e("div",bs,[e("div",$s,[e("h3",Cs,[C[0]||(C[0]=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4 mr-2 text-yellow-500"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13"})],-1)),C[1]||(C[1]=K(" ピン留めされたメッセージ ")),e("span",Ms,"("+f(c.value.length)+")",1)]),c.value.length>0?(s(),a("button",{key:0,onClick:n,class:"text-xs text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"},f(l.value?"折りたたむ":"展開"),1)):_("",!0)]),r.value?(s(),a("div",Ds,C[2]||(C[2]=[e("svg",{class:"animate-spin h-5 w-5 text-gray-500",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)]))):c.value.length===0?(s(),a("div",js,C[3]||(C[3]=[e("p",{class:"text-sm text-gray-500 dark:text-gray-400"},"ピン留めされたメッセージはありません",-1)]))):l.value?(s(),a("div",Ss,[(s(!0),a(ee,null,te(c.value,M=>(s(),a("div",{key:M.id,class:"bg-white dark:bg-gray-700 rounded-lg p-3 border border-gray-200 dark:border-gray-600"},[e("div",Ls,[e("img",{src:M.message.user.avatar,alt:M.message.user.name,class:"w-8 h-8 rounded-full flex-shrink-0"},null,8,Es),e("div",Bs,[e("div",As,[e("div",Ts,[e("span",Ps,f(M.message.user.name),1),e("span",Us,f(M.message.time),1)]),e("button",{onClick:F=>i(M.id),class:"text-gray-400 hover:text-red-500 dark:hover:text-red-400 p-1",title:"ピン留めを解除"},C[4]||(C[4]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,Vs)]),e("p",Os,f(M.message.content),1),M.message.file_path?(s(),a("div",zs,[M.message.file_mime&&M.message.file_mime.startsWith("image/")?(s(),a("img",{key:0,src:`/storage/${M.message.file_path}`,alt:M.message.file_name,class:"max-h-24 rounded border"},null,8,Fs)):(s(),a("div",Is,[C[5]||(C[5]=e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M18.375 12.739l-7.693 7.693a4.5 4.5 0 01-6.364-6.364l10.94-10.94A3 3 0 1119.5 7.372L8.552 18.32m.009-.01l-.01.01m5.699-9.941l-7.81 7.81a1.5 1.5 0 002.112 2.13"})],-1)),e("span",null,f(M.message.file_name),1)]))])):_("",!0),e("div",Rs,f(M.pinned_by.name)+" がピン留めしました ",1)])])]))),128))])):_("",!0)])]))}},Hs={class:"flex-1 flex flex-col bg-white dark:bg-gray-900"},Ns={class:"flex-1 p-6 overflow-y-auto"},Ks={class:"w-10 h-10 rounded bg-purple-400 mr-4 shrink-0"},Ws=["src"],qs={class:"flex-1"},Qs={class:"flex items-center justify-between"},Xs={class:"font-bold text-gray-900 dark:text-gray-100"},Js={class:"text-xs text-gray-500 dark:text-gray-400 font-normal ml-2"},Gs={class:"flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity"},Ys=["onClick"],ea=["onClick"],ta={class:"mt-1"},sa={key:0},aa={key:0,class:"mt-2"},oa=["src","alt","onClick"],ra=["src","onClick"],na=["src","onClick"],la=["src","onClick"],ia=["src","onClick"],da={key:5},ca=["href","download"],ua={class:"text-xs text-gray-400 ml-2"},va={class:"w-10 h-10 rounded bg-purple-400 mr-4 shrink-0"},ha=["src"],ga={class:"flex-1"},ma={class:"flex items-center justify-between"},pa={class:"font-bold text-gray-900 dark:text-gray-100"},fa={class:"text-xs text-gray-500 dark:text-gray-400 font-normal ml-2"},xa={class:"flex items-center space-x-2 opacity-0 group-hover:opacity-100 transition-opacity"},ya=["onClick"],ka=["onClick"],_a={class:"mt-1"},wa={key:0},ba={key:0,class:"mt-2"},$a=["src","alt","onClick"],Ca=["src","onClick"],Ma=["src","onClick"],Da=["src","onClick"],ja=["src","onClick"],Sa={key:5},La=["href","download"],Ea={class:"text-xs text-gray-400 ml-2"},Ba={key:2,class:"text-center text-gray-400 mt-10"},Aa={key:0},Ta=["src","alt"],Pa=["src"],Ua=["src"],Va=["src"],Oa=["src"],za={__name:"MainContent",props:{messages:{type:Array,default:()=>[]},activeChannel:Object,activeDirectMessage:Object},emits:["messageSent","messageUpdated","messageDeleted"],setup(o,{emit:u}){var R;const y=(R=ke().props.auth)==null?void 0:R.user,d=o,c=u,r=h([...d.messages||[]]),l=h(!1),k=h(null),i=h(!1),n=h(null),g=h(null),x=h(!1),C=h({}),M=h({}),F=h(null);de(()=>d.messages,w=>{r.value=[...w||[]],w&&w.forEach(j=>{j.is_pinned!==void 0&&(C.value[j.id]=j.is_pinned),j.pinned_message_id!==void 0&&(M.value[j.id]=j.pinned_message_id)})},{deep:!0});const D=w=>{r.value.unshift(w),c("messageSent",w)},$=w=>{const j=r.value.findIndex(t=>t.id===w.id);j!==-1&&(r.value[j]=w),c("messageUpdated",w)},E=w=>{const j=r.value.findIndex(t=>t.id===w);j!==-1&&r.value.splice(j,1),c("messageDeleted",w)},V=(w,j,t=null)=>{C.value[w]=j,t?M.value[w]=t:delete M.value[w],F.value&&F.value.refreshPinnedMessages()},I=w=>{},W=w=>{k.value=w,l.value=!0},J=()=>{l.value=!1,k.value=null},q=w=>{n.value=w,i.value=!0},G=()=>{i.value=!1,n.value=null},A=w=>{g.value=w,x.value=!0},T=()=>{x.value=!1,g.value=null},O=w=>y&&w.user.id===y.id;return(w,j)=>(s(),a("div",Hs,[b(Bt,{"active-channel":o.activeChannel,"active-direct-message":o.activeDirectMessage},null,8,["active-channel","active-direct-message"]),o.activeChannel?(s(),Z(Zs,{key:0,"channel-id":o.activeChannel.id,onPinRemoved:j[0]||(j[0]=t=>I()),ref_key:"pinnedMessagesListRef",ref:F},null,8,["channel-id"])):_("",!0),e("div",Ns,[o.activeChannel?(s(!0),a(ee,{key:0},te(r.value,t=>(s(),a("div",{key:t.id,class:"flex items-start mb-4 group hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg p-2 -m-2"},[e("div",Ks,[e("img",{src:t.user.avatar,alt:"avatar",class:"w-8 h-8 rounded-full"},null,8,Ws)]),e("div",qs,[e("div",Qs,[e("p",Xs,[K(f(t.user.name)+" ",1),e("span",Js,f(t.time),1)]),e("div",Gs,[b(_s,{"message-id":t.id,"channel-id":o.activeChannel.id,"is-pinned":C.value[t.id]||!1,onPinToggled:(B,S)=>V(t.id,B,S)},null,8,["message-id","channel-id","is-pinned","onPinToggled"]),O(t)?(s(),a("button",{key:0,onClick:B=>W(t),class:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 p-1 rounded",title:"メッセージを編集"},[b(p(fe),{class:"h-4 w-4"})],8,Ys)):_("",!0),O(t)?(s(),a("button",{key:1,onClick:B=>q(t),class:"text-red-500 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 p-1 rounded",title:"メッセージを削除"},j[1]||(j[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,ea)):_("",!0)])]),e("div",ta,[t.content?(s(),a("span",sa,f(t.content),1)):_("",!0)]),t.file_path?(s(),a("div",aa,[t.file_mime&&t.file_mime.startsWith("image/")?(s(),a("img",{key:0,src:`/storage/${t.file_path}`,alt:t.file_name,class:"max-h-48 rounded border cursor-pointer hover:opacity-80 transition",onClick:B=>A({type:"image",src:`/storage/${t.file_path}`,name:t.file_name,mime:t.file_mime})},null,8,oa)):t.file_mime&&t.file_mime.startsWith("video/")?(s(),a("video",{key:1,src:`/storage/${t.file_path}`,controls:"",class:"max-h-48 rounded border cursor-pointer hover:opacity-80 transition",onClick:B=>A({type:"video",src:`/storage/${t.file_path}`,name:t.file_name,mime:t.file_mime})},null,8,ra)):t.file_mime&&t.file_mime.startsWith("audio/")?(s(),a("audio",{key:2,src:`/storage/${t.file_path}`,controls:"",class:"w-full cursor-pointer hover:opacity-80 transition",onClick:B=>A({type:"audio",src:`/storage/${t.file_path}`,name:t.file_name,mime:t.file_mime})},null,8,na)):t.file_mime==="application/pdf"?(s(),a("iframe",{key:3,src:`/storage/${t.file_path}`,class:"w-full max-h-96 border rounded cursor-pointer hover:opacity-80 transition",onClick:B=>A({type:"pdf",src:`/storage/${t.file_path}`,name:t.file_name,mime:t.file_mime})},null,8,la)):["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(t.file_mime)?(s(),a("iframe",{key:4,src:`https://docs.google.com/gview?url=${w.location.origin}/storage/${t.file_path}&embedded=true`,class:"w-full max-h-96 border rounded cursor-pointer hover:opacity-80 transition",onClick:B=>A({type:"doc",src:`https://docs.google.com/gview?url=${w.location.origin}/storage/${t.file_path}&embedded=true`,name:t.file_name,mime:t.file_mime})},null,8,ia)):(s(),a("div",da,[e("a",{href:`/storage/${t.file_path}`,download:t.file_name,class:"text-blue-600 underline",target:"_blank"},f(t.file_name),9,ca),e("span",ua,"("+f((t.file_size/1024).toFixed(1))+" KB)",1)]))])):_("",!0)])]))),128)):o.activeDirectMessage?(s(!0),a(ee,{key:1},te(r.value,t=>(s(),a("div",{key:t.id,class:"flex items-start mb-4 group hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg p-2 -m-2"},[e("div",va,[e("img",{src:t.user.avatar,alt:"avatar",class:"w-8 h-8 rounded-full"},null,8,ha)]),e("div",ga,[e("div",ma,[e("p",pa,[K(f(t.user.name)+" ",1),e("span",fa,f(t.time),1)]),e("div",xa,[O(t)?(s(),a("button",{key:0,onClick:B=>W(t),class:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 p-1 rounded",title:"メッセージを編集"},[b(p(fe),{class:"h-4 w-4"})],8,ya)):_("",!0),O(t)?(s(),a("button",{key:1,onClick:B=>q(t),class:"text-red-500 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 p-1 rounded",title:"メッセージを削除"},j[2]||(j[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-4 w-4"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)]),8,ka)):_("",!0)])]),e("div",_a,[t.content?(s(),a("span",wa,f(t.content),1)):_("",!0)]),t.file_path?(s(),a("div",ba,[t.file_mime&&t.file_mime.startsWith("image/")?(s(),a("img",{key:0,src:`/storage/${t.file_path}`,alt:t.file_name,class:"max-h-48 rounded border cursor-pointer hover:opacity-80 transition",onClick:B=>A({type:"image",src:`/storage/${t.file_path}`,name:t.file_name,mime:t.file_mime})},null,8,$a)):t.file_mime&&t.file_mime.startsWith("video/")?(s(),a("video",{key:1,src:`/storage/${t.file_path}`,controls:"",class:"max-h-48 rounded border cursor-pointer hover:opacity-80 transition",onClick:B=>A({type:"video",src:`/storage/${t.file_path}`,name:t.file_name,mime:t.file_mime})},null,8,Ca)):t.file_mime&&t.file_mime.startsWith("audio/")?(s(),a("audio",{key:2,src:`/storage/${t.file_path}`,controls:"",class:"w-full cursor-pointer hover:opacity-80 transition",onClick:B=>A({type:"audio",src:`/storage/${t.file_path}`,name:t.file_name,mime:t.file_mime})},null,8,Ma)):t.file_mime==="application/pdf"?(s(),a("iframe",{key:3,src:`/storage/${t.file_path}`,class:"w-full max-h-96 border rounded cursor-pointer hover:opacity-80 transition",onClick:B=>A({type:"pdf",src:`/storage/${t.file_path}`,name:t.file_name,mime:t.file_mime})},null,8,Da)):["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"].includes(t.file_mime)?(s(),a("iframe",{key:4,src:`https://docs.google.com/gview?url=${w.location.origin}/storage/${t.file_path}&embedded=true`,class:"w-full max-h-96 border rounded cursor-pointer hover:opacity-80 transition",onClick:B=>A({type:"doc",src:`https://docs.google.com/gview?url=${w.location.origin}/storage/${t.file_path}&embedded=true`,name:t.file_name,mime:t.file_mime})},null,8,ja)):(s(),a("div",Sa,[e("a",{href:`/storage/${t.file_path}`,download:t.file_name,class:"text-blue-600 underline",target:"_blank"},f(t.file_name),9,La),e("span",Ea,"("+f((t.file_size/1024).toFixed(1))+" KB)",1)]))])):_("",!0)])]))),128)):(s(),a("div",Ba,"チャンネルまたはダイレクトメッセージを選択してください"))]),o.activeChannel||o.activeDirectMessage?(s(),Z(Jt,{key:1,"active-channel":o.activeChannel,"active-direct-message":o.activeDirectMessage,onMessageSent:D},null,8,["active-channel","active-direct-message"])):_("",!0),b(ls,{show:l.value,message:k.value,"active-direct-message":o.activeDirectMessage,onClose:J,onMessageUpdated:$},null,8,["show","message","active-direct-message"]),b(fs,{show:i.value,message:n.value,"active-direct-message":o.activeDirectMessage,onClose:G,onMessageDeleted:E},null,8,["show","message","active-direct-message"]),b(je,{show:x.value,"max-width":"4xl",onClose:T},{title:le(()=>{var t;return[K(f((t=g.value)==null?void 0:t.name),1)]}),content:le(()=>[g.value?(s(),a("div",Aa,[g.value.type==="image"?(s(),a("img",{key:0,src:g.value.src,alt:g.value.name,class:"max-h-[70vh] mx-auto rounded border"},null,8,Ta)):g.value.type==="video"?(s(),a("video",{key:1,src:g.value.src,controls:"",class:"max-h-[70vh] mx-auto rounded border"},null,8,Pa)):g.value.type==="audio"?(s(),a("audio",{key:2,src:g.value.src,controls:"",class:"w-full mx-auto"},null,8,Ua)):g.value.type==="pdf"?(s(),a("iframe",{key:3,src:g.value.src,class:"w-full min-h-[60vh] border rounded"},null,8,Va)):g.value.type==="doc"?(s(),a("iframe",{key:4,src:g.value.src,class:"w-full min-h-[60vh] border rounded"},null,8,Oa)):_("",!0)])):_("",!0)]),footer:le(()=>[e("button",{onClick:T,class:"px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-600"},"閉じる")]),_:1},8,["show"])]))}},Fa={class:"flex h-screen bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200"},Ia={class:"flex-1 flex flex-col"},Ka={__name:"AppLayout",props:{title:String,channels:Array,"direct-messages":Array,directMessages:Array,messages:Array,activeChannel:Object,activeDirectMessage:Object,manualOffline:Boolean},emits:["selectChannel","newChannelAdded","messageSent","messageUpdated","messageDeleted","toggleManualOffline","channelDeleted","channelLeft","selectDirectMessage","directMessageStarted"],setup(o,{emit:u}){const m=o,y=u,d=be(()=>m.directMessages||m["direct-messages"]||[]);return(c,r)=>(s(),a("div",null,[b(p($e),{title:o.title},null,8,["title"]),e("div",Fa,[b(Ce),b(De,{channels:o.channels,"direct-messages":d.value,"manual-offline":o.manualOffline,onToggleManualOffline:r[0]||(r[0]=l=>y("toggleManualOffline",l)),onSelectChannel:r[1]||(r[1]=l=>y("selectChannel",l)),onNewChannelAdded:r[2]||(r[2]=l=>y("newChannelAdded",l)),onChannelDeleted:r[3]||(r[3]=l=>y("channelDeleted",l)),onChannelLeft:r[4]||(r[4]=l=>y("channelLeft",l)),onSelectDirectMessage:r[5]||(r[5]=l=>y("selectDirectMessage",l)),onDirectMessageStarted:r[6]||(r[6]=l=>y("directMessageStarted",l))},null,8,["channels","direct-messages","manual-offline"]),e("div",Ia,[me(c.$slots,"notifications"),me(c.$slots,"default"),o.activeChannel||o.activeDirectMessage?(s(),Z(za,{key:0,messages:o.messages,"active-channel":o.activeChannel,"active-direct-message":o.activeDirectMessage,onMessageSent:r[7]||(r[7]=l=>y("messageSent",l)),onMessageUpdated:r[8]||(r[8]=l=>y("messageUpdated",l)),onMessageDeleted:r[9]||(r[9]=l=>y("messageDeleted",l))},null,8,["messages","active-channel","active-direct-message"])):_("",!0)])])]))}};export{Ka as _};
